<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>ATLAS Workspace â€“ Ù…Ø­Ù…ÙˆØ¯ Ø§Ù„ØµÙ…Ø§Ø¯ÙŠ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- Ø®Ø· Ø¹Ø±Ø¨ÙŠ + Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ -->
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700&family=Inter:wght@400;600&display=swap" rel="stylesheet" />

  <style>
    :root {
      --radius-lg: 18px;
      --radius-md: 12px;
      --radius-sm: 8px;
      --transition-fast: 0.18s ease-out;
      /* Ø£Ù„ÙˆØ§Ù† Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø¯Ø§ÙƒÙ† Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ */
      --bg-main: #050816;
      --bg-elevated: #0b1020;
      --bg-softer: #11172a;
      --border-subtle: rgba(255,255,255,0.06);
      --accent: #00b3ff;
      --accent-soft: rgba(0,179,255,0.09);
      --accent-strong: #00d4ff;
      --text-main: #f5f7ff;
      --text-soft: #b8bfdc;
      --danger: #ff4b6a;
      --success: #2ecc71;
      --shadow-soft: 0 18px 45px rgba(0,0,0,0.55);
    }

    /* Ø«ÙŠÙ… Ù„Ø§ÙŠØª */
    body.theme-light {
      --bg-main: #f5f7fb;
      --bg-elevated: #ffffff;
      --bg-softer: #eef1fa;
      --border-subtle: rgba(10,20,60,0.09);
      --accent: #1769ff;
      --accent-soft: rgba(23,105,255,0.08);
      --accent-strong: #1450c8;
      --text-main: #111827;
      --text-soft: #6b7280;
      --shadow-soft: 0 14px 35px rgba(15,23,42,0.18);
    }

    /* Ø«ÙŠÙ… OLED Ø£Ø³ÙˆØ¯ ÙƒØ§Ù…Ù„ */
    body.theme-oled {
      --bg-main: #000000;
      --bg-elevated: #050509;
      --bg-softer: #070711;
      --border-subtle: rgba(255,255,255,0.05);
      --accent: #00e0ff;
      --accent-soft: rgba(0,224,255,0.12);
      --accent-strong: #4dffb5;
      --text-main: #f9fafb;
      --text-soft: #9ca3af;
      --shadow-soft: 0 20px 60px rgba(0,0,0,0.85);
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      min-height: 100vh;
      font-family: "Cairo", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, #111827 0, var(--bg-main) 45%, #000 100%);
      color: var(--text-main);
      display: flex;
      align-items: stretch;
      justify-content: center;
    }

    /* Ø­Ø§ÙˆÙŠØ© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ */
    .app-shell {
      flex: 1;
      max-width: 1320px;
      margin: 20px auto;
      display: flex;
      gap: 18px;
      padding: 12px;
    }

    /* Ø´Ø§Ø´Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ */
    .auth-screen {
      margin: auto;
      max-width: 480px;
      width: 100%;
      background: linear-gradient(145deg, rgba(15,23,42,0.9), rgba(15,118,255,0.12));
      border-radius: 28px;
      padding: 28px 26px 24px;
      box-shadow: var(--shadow-soft);
      border: 1px solid var(--border-subtle);
    }

    .auth-logo-circle {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      background: radial-gradient(circle at 30% 20%, #4ade80, #22c55e 40%, #0b1120 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      color: #f9fafb;
      font-weight: 800;
      font-size: 26px;
      margin-bottom: 16px;
      box-shadow: 0 12px 30px rgba(34,197,94,0.45);
    }

    .auth-title {
      font-size: 24px;
      font-weight: 700;
      margin-bottom: 6px;
    }

    .auth-sub {
      font-size: 14px;
      color: var(--text-soft);
      margin-bottom: 18px;
    }

    .auth-created {
      font-size: 13px;
      color: var(--text-soft);
      margin-bottom: 22px;
    }

    .auth-created span {
      color: var(--accent-strong);
      font-weight: 600;
    }

    .auth-btn {
      width: 100%;
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,0.3);
      background: rgba(15,23,42,0.8);
      padding: 10px 16px;
      display: flex;
      align-items: center;
      gap: 10px;
      color: var(--text-main);
      cursor: pointer;
      transition: background var(--transition-fast), transform var(--transition-fast), box-shadow var(--transition-fast), border-color var(--transition-fast);
    }

    .auth-btn:hover {
      background: rgba(15,118,255,0.12);
      border-color: rgba(59,130,246,0.8);
      transform: translateY(-1px);
      box-shadow: 0 10px 26px rgba(37,99,235,0.35);
    }

    .auth-btn img {
      width: 20px;
      height: 20px;
    }

    .auth-btn span {
      flex: 1;
      text-align: center;
      font-weight: 600;
      font-size: 14px;
    }

    .auth-divider {
      text-align: center;
      font-size: 12px;
      color: var(--text-soft);
      margin: 18px 0 12px;
      position: relative;
    }

    .auth-divider::before,
    .auth-divider::after {
      content: "";
      position: absolute;
      top: 50%;
      width: 32%;
      height: 1px;
      background: linear-gradient(to left, transparent, rgba(148,163,184,0.5));
    }

    .auth-divider::after {
      left: 68%;
      transform: translateY(-50%);
    }
    .auth-divider::before {
      right: 68%;
      transform: translateY(-50%);
    }

    .auth-footer-note {
      margin-top: 12px;
      font-size: 11px;
      color: var(--text-soft);
      line-height: 1.8;
    }

    .auth-footer-note strong {
      color: var(--accent-strong);
    }

    /* Ø¨Ø¹Ø¯ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ */
    .hidden {
      display: none !important;
    }

    /* Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠ */
    .sidebar {
      width: 240px;
      background: rgba(8,12,28,0.92);
      border-radius: 26px;
      padding: 18px 16px;
      border: 1px solid var(--border-subtle);
      box-shadow: var(--shadow-soft);
      display: flex;
      flex-direction: column;
      gap: 18px;
    }

    .sidebar-top {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .avatar {
      width: 42px;
      height: 42px;
      border-radius: 50%;
      overflow: hidden;
      border: 2px solid rgba(56,189,248,0.8);
      box-shadow: 0 0 0 2px rgba(15,23,42,0.9);
      flex-shrink: 0;
    }

    .avatar img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .avatar-fallback {
      width: 100%;
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      background: radial-gradient(circle at 30% 20%, #06b6d4, #3b82f6 40%, #020617 100%);
      font-weight: 800;
      font-size: 22px;
      color: #e5f4ff;
    }

    .user-meta {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .user-meta-name {
      font-size: 15px;
      font-weight: 700;
    }

    .user-meta-email {
      font-size: 11px;
      color: var(--text-soft);
      direction: ltr;
      text-align: left;
    }

    .sidebar-section-label {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      color: var(--text-soft);
      margin-top: 6px;
      margin-bottom: 6px;
    }

    .nav-list {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .nav-item {
      border-radius: 999px;
      padding: 7px 10px;
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 13px;
      color: var(--text-soft);
      cursor: pointer;
      border: 1px solid transparent;
      transition: background var(--transition-fast), color var(--transition-fast), border-color var(--transition-fast), transform var(--transition-fast);
    }

    .nav-item span.nav-icon {
      width: 22px;
      text-align: center;
      font-size: 15px;
    }

    .nav-item.active,
    .nav-item:hover {
      background: var(--accent-soft);
      color: var(--accent-strong);
      border-color: rgba(56,189,248,0.7);
      transform: translateY(-1px);
    }

    .sidebar-footer {
      margin-top: auto;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .logout-btn {
      border-radius: 999px;
      border: 1px solid rgba(248,113,113,0.5);
      background: rgba(127,29,29,0.2);
      color: #fecaca;
      font-size: 12px;
      padding: 7px 10px;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 6px;
      justify-content: center;
      transition: background var(--transition-fast), transform var(--transition-fast), box-shadow var(--transition-fast);
    }

    .logout-btn:hover {
      background: rgba(220,38,38,0.45);
      transform: translateY(-1px);
      box-shadow: 0 10px 22px rgba(185,28,28,0.55);
    }

    .made-by {
      font-size: 10px;
      text-align: center;
      color: var(--text-soft);
      line-height: 1.7;
    }

    .made-by strong {
      color: var(--accent-strong);
    }

    /* Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ */
    .main-panel {
      flex: 1;
      background: rgba(6,10,24,0.96);
      border-radius: 26px;
      border: 1px solid var(--border-subtle);
      box-shadow: var(--shadow-soft);
      padding: 18px 18px 16px;
      display: flex;
      flex-direction: column;
      gap: 14px;
      overflow: hidden;
    }

    .top-bar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
    }

    .top-bar-left {
      display: flex;
      flex-direction: column;
    }

    .greeting {
      font-size: 18px;
      font-weight: 700;
    }

    .greeting span {
      color: var(--accent-strong);
    }

    .greeting-sub {
      font-size: 12px;
      color: var(--text-soft);
    }

    .theme-toggle {
      display: flex;
      align-items: center;
      gap: 6px;
      background: var(--bg-softer);
      padding: 4px;
      border-radius: 999px;
      border: 1px solid var(--border-subtle);
    }

    .theme-btn {
      font-size: 11px;
      padding: 6px 10px;
      border-radius: 999px;
      border: none;
      cursor: pointer;
      background: transparent;
      color: var(--text-soft);
      transition: background var(--transition-fast), color var(--transition-fast), transform var(--transition-fast);
    }

    .theme-btn.active {
      background: var(--accent-soft);
      color: var(--accent-strong);
      transform: translateY(-1px);
    }

    .widgets-row {
      display: grid;
      grid-template-columns: repeat(4, minmax(0,1fr));
      gap: 10px;
    }

    .widget-card {
      background: var(--bg-softer);
      border-radius: var(--radius-md);
      padding: 10px 10px 10px;
      border: 1px solid var(--border-subtle);
      display: flex;
      flex-direction: column;
      gap: 6px;
      font-size: 12px;
    }

    .widget-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 6px;
    }

    .widget-title {
      display: flex;
      align-items: center;
      gap: 6px;
      font-weight: 600;
      font-size: 12px;
    }

    .widget-pill {
      font-size: 10px;
      padding: 2px 7px;
      border-radius: 999px;
      background: rgba(15,23,42,0.9);
      color: var(--accent-strong);
      border: 1px solid rgba(56,189,248,0.7);
    }

    .widget-value {
      font-size: 13px;
      font-weight: 600;
    }

    .widget-controls {
      display: flex;
      align-items: center;
      gap: 4px;
      margin-top: 2px;
    }

    .widget-btn {
      flex: 1;
      border-radius: 999px;
      border: 1px solid var(--border-subtle);
      background: rgba(15,23,42,0.85);
      color: var(--text-soft);
      font-size: 11px;
      padding: 4px 6px;
      cursor: pointer;
      transition: background var(--transition-fast), color var(--transition-fast), border-color var(--transition-fast), transform var(--transition-fast);
    }

    .widget-btn:hover {
      background: var(--accent-soft);
      color: var(--accent-strong);
      border-color: rgba(56,189,248,0.8);
      transform: translateY(-1px);
    }

    .widget-progress {
      margin-top: 4px;
      height: 6px;
      border-radius: 999px;
      background: rgba(15,23,42,0.9);
      overflow: hidden;
    }

    .widget-progress-inner {
      height: 100%;
      width: 0%;
      border-radius: 999px;
      background: linear-gradient(90deg, var(--accent), var(--accent-strong));
      transition: width 0.25s ease-out;
    }

    /* Ù‚Ø³Ù… Ø§Ù„Ù†ÙˆØªØ§Øª */
    .notes-area {
      flex: 1;
      display: grid;
      grid-template-columns: minmax(0, 5fr) minmax(0, 4fr);
      gap: 12px;
      min-height: 0;
    }

    .notes-list {
      background: var(--bg-softer);
      border-radius: var(--radius-md);
      border: 1px solid var(--border-subtle);
      padding: 10px;
      display: flex;
      flex-direction: column;
      gap: 8px;
      overflow-y: auto;
    }

    .section-title-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 4px;
    }

    .section-title-row h3 {
      font-size: 13px;
      font-weight: 700;
    }

    .section-title-row span {
      font-size: 11px;
      color: var(--text-soft);
    }

    .primary-pill-btn {
      border-radius: 999px;
      border: none;
      padding: 5px 10px;
      font-size: 11px;
      cursor: pointer;
      background: var(--accent-soft);
      color: var(--accent-strong);
      display: inline-flex;
      align-items: center;
      gap: 5px;
      transition: background var(--transition-fast), transform var(--transition-fast), box-shadow var(--transition-fast);
    }

    .primary-pill-btn:hover {
      background: rgba(56,189,248,0.22);
      transform: translateY(-1px);
      box-shadow: 0 8px 20px rgba(56,189,248,0.4);
    }

    .note-card {
      background: rgba(15,23,42,0.95);
      border-radius: 14px;
      border: 1px solid rgba(148,163,184,0.18);
      padding: 8px 9px;
      display: flex;
      flex-direction: column;
      gap: 4px;
      cursor: pointer;
      transition: border-color var(--transition-fast), transform var(--transition-fast), box-shadow var(--transition-fast), background var(--transition-fast);
    }

    .note-card:hover {
      border-color: rgba(56,189,248,0.9);
      background: rgba(15,23,42,0.98);
      transform: translateY(-1px);
      box-shadow: 0 10px 25px rgba(15,23,42,0.75);
    }

    .note-card-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 6px;
    }

    .note-card-title {
      font-size: 13px;
      font-weight: 700;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .note-chip {
      font-size: 10px;
      padding: 1px 6px;
      border-radius: 999px;
      background: rgba(15,23,42,0.9);
      border: 1px solid rgba(148,163,184,0.5);
      color: var(--text-soft);
    }

    .note-card-meta {
      font-size: 10px;
      color: var(--text-soft);
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 6px;
    }

    .note-card-snippet {
      font-size: 11px;
      color: var(--text-soft);
      max-height: 34px;
      overflow: hidden;
    }

    /* Ù…Ø­Ø±Ø± Ø§Ù„Ù†ÙˆØª */
    .note-editor {
      background: var(--bg-softer);
      border-radius: var(--radius-md);
      border: 1px solid var(--border-subtle);
      padding: 10px;
      display: flex;
      flex-direction: column;
      gap: 8px;
      overflow: hidden;
    }

    .note-editor input,
    .note-editor textarea,
    .note-editor select {
      width: 100%;
      border-radius: 10px;
      border: 1px solid rgba(148,163,184,0.35);
      background: rgba(15,23,42,0.9);
      padding: 7px 9px;
      color: var(--text-main);
      font-size: 12px;
      resize: vertical;
      min-height: 0;
      outline: none;
      transition: border-color var(--transition-fast), box-shadow var(--transition-fast), background var(--transition-fast), transform var(--transition-fast);
      font-family: inherit;
    }

    .note-editor input:focus,
    .note-editor textarea:focus,
    .note-editor select:focus {
      border-color: rgba(56,189,248,0.9);
      box-shadow: 0 0 0 1px rgba(56,189,248,0.6);
      transform: translateY(-0.5px);
    }

    .note-editor textarea {
      min-height: 120px;
      line-height: 1.7;
    }

    .note-editor-row {
      display: flex;
      gap: 6px;
      flex-wrap: wrap;
    }

    .note-editor-row > * {
      flex: 1;
      min-width: 0;
    }

    .note-editor-label {
      font-size: 11px;
      color: var(--text-soft);
      margin-bottom: 2px;
    }

    .note-editor-footer {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 6px;
      margin-top: 2px;
    }

    .note-editor-actions {
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .ghost-btn {
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,0.45);
      background: transparent;
      color: var(--text-soft);
      font-size: 11px;
      padding: 5px 10px;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 5px;
      transition: background var(--transition-fast), color var(--transition-fast), transform var(--transition-fast), box-shadow var(--transition-fast), border-color var(--transition-fast);
    }

    .ghost-btn:hover {
      background: rgba(15,23,42,0.95);
      color: var(--accent-strong);
      border-color: rgba(56,189,248,0.85);
      transform: translateY(-1px);
      box-shadow: 0 9px 20px rgba(15,23,42,0.8);
    }

    .ghost-btn.destroy {
      border-color: rgba(248,113,113,0.7);
      color: #fecaca;
    }

    .ghost-btn.destroy:hover {
      background: rgba(127,29,29,0.9);
      box-shadow: 0 9px 20px rgba(239,68,68,0.7);
      color: #fff1f2;
    }

    .note-preview-image {
      width: 100%;
      max-height: 160px;
      border-radius: 12px;
      object-fit: cover;
      border: 1px solid rgba(148,163,184,0.5);
      margin-top: 4px;
    }

    .small-helper {
      font-size: 10px;
      color: var(--text-soft);
    }

    @media (max-width: 1024px) {
      .app-shell {
        flex-direction: column;
      }
      .sidebar {
        flex-direction: row;
        align-items: center;
        width: 100%;
        padding: 12px;
      }
      .sidebar-top {
        flex: 1;
      }
      .nav-list {
        flex-direction: row;
        flex-wrap: wrap;
      }
      .sidebar-footer {
        align-items: flex-end;
      }
      .notes-area {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    @media (max-width: 720px) {
      .widgets-row {
        grid-template-columns: repeat(2, minmax(0,1fr));
      }
      .auth-screen {
        margin: 0 10px;
      }
    }
  </style>
</head>

<body class="theme-dark">
  <!-- Ø´Ø§Ø´Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ -->
  <div id="auth-screen" class="auth-screen">
    <div class="auth-logo-circle">A</div>
    <div class="auth-title">ATLAS Workspace</div>
    <div class="auth-sub">Ù…Ø³Ø§Ø­ØªÙƒ Ø§Ù„ÙŠÙˆÙ…ÙŠØ© Ù„ØªÙ†Ø¸ÙŠÙ… Ø­ÙŠØ§ØªÙƒ: Ù†ÙˆØªØ§ØªØŒ Ø¹Ø§Ø¯Ø§ØªØŒ ÙˆØªØªØ¨Ø¹ Ù…Ø§Ø¡ / Ù†ÙˆÙ… / ØµÙ„Ø§Ø© / Ø¬ÙŠÙ…â€¦ ÙÙŠ Ù…ÙƒØ§Ù† ÙˆØ§Ø­Ø¯.</div>
    <div class="auth-created">Ù‡Ø°Ø§ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ù…Ù† Ø¥Ù†Ø´Ø§Ø¡ <span>Ù…Ø­Ù…ÙˆØ¯ Ø§Ù„ØµÙ…Ø§Ø¯ÙŠ</span> â€“ powered by Firebase.</div>

    <button id="google-login" class="auth-btn">
      <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" alt="Google" />
      <span>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ø­Ø³Ø§Ø¨ Google</span>
    </button>

    <div class="auth-divider"> Ø£Ùˆ </div>

    <p class="auth-footer-note">
      Ø¨Ø¹Ø¯ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø³ÙŠØªÙ… Ø­ÙØ¸ Ù†ÙˆØªØ§ØªÙƒ ÙˆØ¥Ø¹Ø¯Ø§Ø¯Ø§ØªÙƒ Ø¹Ù„Ù‰ Ø­Ø³Ø§Ø¨ÙƒØŒ ÙˆØªÙ‚Ø¯Ø± ØªÙØªØ­Ù‡Ø§ Ù…Ù† Ø£ÙŠ Ø¬Ù‡Ø§Ø².<br />
      ÙŠÙ…ÙƒÙ†Ùƒ Ù„Ø§Ø­Ù‚Ù‹Ø§ Ø¥Ø¶Ø§ÙØ© Ø·Ø±Ù‚ ØªØ³Ø¬ÙŠÙ„ Ø£Ø®Ø±Ù‰ (Apple, Facebookâ€¦) Ù…Ù† Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Firebase.
    </p>
  </div>

  <!-- Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¨Ø¹Ø¯ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ -->
  <div id="app-shell" class="app-shell hidden">
    <!-- Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠ -->
    <aside class="sidebar">
      <div class="sidebar-top">
        <div class="avatar">
          <div id="user-avatar-fallback" class="avatar-fallback">A</div>
          <img id="user-avatar-img" src="" alt="" style="display:none;" />
        </div>
        <div class="user-meta">
          <div id="user-name" class="user-meta-name">Ù…Ø­Ù…ÙˆØ¯ Ø§Ù„ØµÙ…Ø§Ø¯ÙŠ</div>
          <div id="user-email" class="user-meta-email">example@gmail.com</div>
        </div>
      </div>

      <div>
        <div class="sidebar-section-label">Ø§Ù„Ø£Ù‚Ø³Ø§Ù…</div>
        <nav class="nav-list">
          <div class="nav-item active"><span class="nav-icon">ğŸ </span>Ù„ÙˆØ­Ø© Ø§Ù„ÙŠÙˆÙ…</div>
          <div class="nav-item"><span class="nav-icon">ğŸ“</span>Ø§Ù„Ù†ÙˆØªØ§Øª</div>
          <div class="nav-item"><span class="nav-icon">ğŸ“Š</span>Ø§Ù„Ø¹Ø§Ø¯Ø§Øª / Ø§Ù„ÙˆØ¯Ø¬Øª</div>
          <div class="nav-item"><span class="nav-icon">ğŸŒ</span>Ø§Ù„Ù…Ø¬ØªÙ…Ø¹ (Ù‚Ø±ÙŠØ¨Ø§Ù‹)</div>
        </nav>
      </div>

      <div class="sidebar-footer">
        <button id="logout-btn" class="logout-btn">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>
        <div class="made-by">
          ATLAS Workspace v1.0<br />
          ØµÙÙ…Ù… Ø¨ÙˆØ§Ø³Ø·Ø© <strong>Ù…Ø­Ù…ÙˆØ¯ Ø§Ù„ØµÙ…Ø§Ø¯ÙŠ</strong> â€“ Ù„Ù„Ø¥Ù†ØªØ§Ø¬ÙŠØ© Ø§Ù„ÙŠÙˆÙ…ÙŠØ©.
        </div>
      </div>
    </aside>

    <!-- Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© -->
    <main class="main-panel">
      <header class="top-bar">
        <div class="top-bar-left">
          <div id="greeting" class="greeting">ØµØ¨Ø§Ø­ Ø§Ù„Ø®ÙŠØ±ØŒ <span>Ù…Ø­Ù…ÙˆØ¯</span> ğŸ‘‹</div>
          <div class="greeting-sub">Ø±ØªÙ‘Ø¨ ÙŠÙˆÙ…ÙƒØŒ Ø³Ø¬Ù‘Ù„ Ù†ÙˆØªØ§ØªÙƒØŒ ÙˆØªØ§Ø¨Ø¹ Ø¹Ø§Ø¯Ø§ØªÙƒ Ù…Ù† Ù…ÙƒØ§Ù† ÙˆØ§Ø­Ø¯.</div>
        </div>
        <div class="theme-toggle">
          <button class="theme-btn active" data-theme="dark">Ø¯Ø§ÙƒÙ†</button>
          <button class="theme-btn" data-theme="light">ÙØ§ØªØ­</button>
          <button class="theme-btn" data-theme="oled">Ø£Ø³ÙˆØ¯ OLED</button>
        </div>
      </header>

      <!-- ÙˆÙŠØ¯Ø¬Øª Ø§Ù„Ø­ÙŠØ§Ù‡ Ø§Ù„ÙŠÙˆÙ…ÙŠØ© -->
      <section class="widgets-row" id="widgets-row">
        <div class="widget-card" data-widget="water">
          <div class="widget-header">
            <div class="widget-title"><span>ğŸ’§</span>Ù…Ø§Ø¡ Ø§Ù„ÙŠÙˆÙ…</div>
            <span class="widget-pill">Ù‡Ø¯Ù: 8 Ø£ÙƒÙˆØ§Ø¨</span>
          </div>
          <div class="widget-value" id="water-value">0 / 8 Ø£ÙƒÙˆØ§Ø¨</div>
          <div class="widget-controls">
            <button class="widget-btn" data-action="minus">âˆ’ 1</button>
            <button class="widget-btn" data-action="plus">+ 1</button>
            <button class="widget-btn" data-action="reset">ØªØµÙÙŠØ±</button>
          </div>
          <div class="widget-progress">
            <div class="widget-progress-inner" id="water-progress"></div>
          </div>
        </div>

        <div class="widget-card" data-widget="sleep">
          <div class="widget-header">
            <div class="widget-title"><span>ğŸ˜´</span>Ù†ÙˆÙ… Ø§Ù„Ù„ÙŠÙ„Ø©</div>
            <span class="widget-pill">Ù‡Ø¯Ù: 8 Ø³Ø§Ø¹Ø§Øª</span>
          </div>
          <div class="widget-value" id="sleep-value">0 / 8 Ø³Ø§Ø¹Ø§Øª</div>
          <div class="widget-controls">
            <button class="widget-btn" data-action="minus">âˆ’ 1</button>
            <button class="widget-btn" data-action="plus">+ 1</button>
            <button class="widget-btn" data-action="reset">ØªØµÙÙŠØ±</button>
          </div>
          <div class="widget-progress">
            <div class="widget-progress-inner" id="sleep-progress"></div>
          </div>
        </div>

        <div class="widget-card" data-widget="prayer">
          <div class="widget-header">
            <div class="widget-title"><span>ğŸ•Œ</span>Ø§Ù„ØµÙ„ÙˆØ§Øª</div>
            <span class="widget-pill">Ù‡Ø¯Ù: 5 / 5</span>
          </div>
          <div class="widget-value" id="prayer-value">0 / 5 ØµÙ„ÙˆØ§Øª</div>
          <div class="widget-controls">
            <button class="widget-btn" data-action="minus">âˆ’ 1</button>
            <button class="widget-btn" data-action="plus">+ 1</button>
            <button class="widget-btn" data-action="reset">ØªØµÙÙŠØ±</button>
          </div>
          <div class="widget-progress">
            <div class="widget-progress-inner" id="prayer-progress"></div>
          </div>
        </div>

        <div class="widget-card" data-widget="gym">
          <div class="widget-header">
            <div class="widget-title"><span>ğŸ‹ï¸â€â™‚ï¸</span>Ø§Ù„ØªÙ…Ø±ÙŠÙ† / Ø§Ù„Ø¬ÙŠÙ…</div>
            <span class="widget-pill">Ù‡Ø¯Ù: 3 Ù…Ø±Ø§Øª / Ø£Ø³Ø¨ÙˆØ¹</span>
          </div>
          <div class="widget-value" id="gym-value">0 / 3 Ø¬Ù„Ø³Ø§Øª</div>
          <div class="widget-controls">
            <button class="widget-btn" data-action="minus">âˆ’ 1</button>
            <button class="widget-btn" data-action="plus">+ 1</button>
            <button class="widget-btn" data-action="reset">ØªØµÙÙŠØ±</button>
          </div>
          <div class="widget-progress">
            <div class="widget-progress-inner" id="gym-progress"></div>
          </div>
        </div>
      </section>

      <!-- Ù†ÙˆØªØ§Øª + Ù…Ø­Ø±Ø± -->
      <section class="notes-area">
        <!-- Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù†ÙˆØªØ§Øª -->
        <div class="notes-list">
          <div class="section-title-row">
            <div>
              <h3>Ù†ÙˆØªØ§ØªÙƒ</h3>
              <span>ÙƒÙ„ Ù†ÙˆØªØ© ØªÙ‚Ø¯Ø± ØªØ®ØµØµ Ø´ÙƒÙ„Ù‡Ø§ ÙˆØ£Ù„ÙˆØ§Ù†Ù‡Ø§ ÙˆØµÙˆØ±ØªÙ‡Ø§.</span>
            </div>
            <button id="new-note-btn" class="primary-pill-btn">+ Ù†ÙˆØªØ© Ø¬Ø¯ÙŠØ¯Ø©</button>
          </div>

          <div id="notes-container">
            <!-- ÙŠØªÙ… ØªØ¹Ø¨Ø¦ØªÙ‡Ø§ Ù…Ù† Ø¬Ø§ÙØ§Ø³ÙƒØ±Ø¨Øª -->
          </div>
        </div>

        <!-- Ù…Ø­Ø±Ø± Ø§Ù„Ù†ÙˆØª -->
        <div class="note-editor">
          <div class="section-title-row">
            <div>
              <h3 id="editor-title-label">Ø¥Ù†Ø´Ø§Ø¡ Ù†ÙˆØªØ© Ø¬Ø¯ÙŠØ¯Ø©</h3>
              <span id="editor-sub-label">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø¹Ù†ÙˆØ§Ù†â€¦ Ø«Ù… Ø§ÙƒØªØ¨ ÙÙƒØ±ØªÙƒØŒ Ù…Ø°ÙƒÙ‘Ø±ØªÙƒØŒ Ø£Ùˆ Ø®Ø·Ø© Ø§Ù„ÙŠÙˆÙ….</span>
            </div>
          </div>

          <div>
            <div class="note-editor-label">Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</div>
            <input id="note-title" placeholder="Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù†ÙˆØªØ© (Ù…Ø«Ø§Ù„: Ø®Ø·Ø© ØªØ¯Ø§ÙˆÙ„ NFPØŒ Ø®Ø·Ø© Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ø¯Ø±Ø§Ø³Ø©â€¦)" />
          </div>

          <div>
            <div class="note-editor-label">Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù†ÙˆØªØ©</div>
            <textarea id="note-content" placeholder="Ø§ÙƒØªØ¨ Ù‡Ù†Ø§ ÙƒÙ„ Ø§Ù„ØªÙØ§ØµÙŠÙ„ØŒ Ø§Ù„Ø£ÙÙƒØ§Ø±ØŒ Ø£Ùˆ Ø§Ù„Ù…Ù‡Ø§Ù…â€¦"></textarea>
          </div>

          <div>
            <div class="note-editor-label">Ø±Ø§Ø¨Ø· ØµÙˆØ±Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</div>
            <input id="note-image" placeholder="Ù…Ø«Ø§Ù„: https://â€¦" />
            <div class="small-helper">Ù„Ùˆ ÙˆØ¶Ø¹Øª Ø±Ø§Ø¨Ø· ØµÙˆØ±Ø© ØµØ­ÙŠØ­ØŒ Ø³ÙŠØªÙ… Ø¹Ø±Ø¶Ù‡Ø§ Ø£Ø¹Ù„Ù‰ Ø§Ù„Ù†ÙˆØªØ© ÙƒØºÙ„Ø§Ù.</div>
            <img id="note-preview-image" class="note-preview-image" src="" alt="" style="display:none;" />
          </div>

          <div class="note-editor-row">
            <div>
              <div class="note-editor-label">Ø­Ø¬Ù… Ø§Ù„Ø®Ø·</div>
              <select id="note-font-size">
                <option value="14">ØµØºÙŠØ± Ù…Ø±ÙŠØ­</option>
                <option value="16" selected>Ù…ØªÙˆØ³Ø· ÙŠÙˆÙ…ÙŠ</option>
                <option value="18">ÙƒØ¨ÙŠØ± ÙˆÙˆØ§Ø¶Ø­</option>
                <option value="20">Ø¹Ù†ÙˆØ§Ù†ÙŠ / Ø¹Ø±Ø¶</option>
              </select>
            </div>
            <div>
              <div class="note-editor-label">Ø³Ù…Ø§ÙƒØ© Ø§Ù„Ø®Ø·</div>
              <select id="note-font-weight">
                <option value="400">Ø¹Ø§Ø¯ÙŠ</option>
                <option value="500">Ø´Ø¨Ù‡ Ø¹Ø±ÙŠØ¶</option>
                <option value="600" selected>Ø¹Ø±ÙŠØ¶ ÙˆØ§Ø¶Ø­</option>
                <option value="700">Ø¹Ø±ÙŠØ¶ Ø¬Ø¯Ø§Ù‹</option>
              </select>
            </div>
            <div>
              <div class="note-editor-label">Ù„ÙˆÙ† Ø§Ù„Ø®Ø·</div>
              <input id="note-color" type="color" value="#e5e7eb" />
            </div>
          </div>

          <div class="note-editor-footer">
            <div class="small-helper">
              ÙŠÙ…ÙƒÙ†Ùƒ Ù„Ø§Ø­Ù‚Ù‹Ø§ Ù…Ø´Ø§Ø±ÙƒØ© Ù„Ù‚Ø·Ø§Øª Ù…Ù† Ù†ÙˆØªØ§ØªÙƒ Ø§Ù„Ø¥Ø¨Ø¯Ø§Ø¹ÙŠØ© Ø¹Ù„Ù‰ TikTok / Instagram ÙƒÙ‚ÙˆØ§Ù„Ø¨ ATLAS.
            </div>
            <div class="note-editor-actions">
              <button id="delete-note-btn" class="ghost-btn destroy" style="display:none;">Ø­Ø°Ù Ø§Ù„Ù†ÙˆØªØ©</button>
              <button id="save-note-btn" class="ghost-btn">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ù†ÙˆØªØ©</button>
            </div>
          </div>
        </div>
      </section>
    </main>
  </div>

  <!-- Firebase + Ù…Ù†Ø·Ù‚ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ -->
  <script type="module">
    // ØªØ­Ù…ÙŠÙ„ Firebase v10 Ù…Ù† CDN
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import {
      getAuth,
      GoogleAuthProvider,
      signInWithPopup,
      onAuthStateChanged,
      signOut
    } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
    import {
      getFirestore,
      doc,
      setDoc,
      getDoc,
      collection,
      addDoc,
      getDocs,
      updateDoc,
      deleteDoc,
      serverTimestamp,
      query,
      orderBy
    } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ù…Ø´Ø±ÙˆØ¹Ùƒ (Ù…Ù† Firebase Console)
    const firebaseConfig = {
      apiKey: "AIzaSyDTOtQbGaLpGtDc34GXzcdppCvEJ60TYSs",
      authDomain: "atlas-workspace.firebaseapp.com",
      projectId: "atlas-workspace",
      storageBucket: "atlas-workspace.firebasestorage.app",
      messagingSenderId: "95882710960",
      appId: "1:95882710960:web:9fcafcc1d4d057029ad075",
      measurementId: "G-KJ446WXXHG"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);
    const provider = new GoogleAuthProvider();

    // Ø¹Ù†Ø§ØµØ± DOM
    const authScreen = document.getElementById("auth-screen");
    const appShell = document.getElementById("app-shell");
    const googleLoginBtn = document.getElementById("google-login");
    const logoutBtn = document.getElementById("logout-btn");
    const userNameEl = document.getElementById("user-name");
    const userEmailEl = document.getElementById("user-email");
    const userAvatarImg = document.getElementById("user-avatar-img");
    const userAvatarFallback = document.getElementById("user-avatar-fallback");
    const greetingEl = document.getElementById("greeting");

    const themeButtons = document.querySelectorAll(".theme-btn");

    const widgetsConfig = {
      water: { target: 8, label: "Ø£ÙƒÙˆØ§Ø¨" },
      sleep: { target: 8, label: "Ø³Ø§Ø¹Ø§Øª" },
      prayer: { target: 5, label: "ØµÙ„ÙˆØ§Øª" },
      gym: { target: 3, label: "Ø¬Ù„Ø³Ø§Øª" }
    };

    let currentUser = null;
    let currentNoteId = null;

    // Ø¹Ù†Ø§ØµØ± Ø§Ù„Ù†ÙˆØª
    const notesContainer = document.getElementById("notes-container");
    const newNoteBtn = document.getElementById("new-note-btn");
    const noteTitleInput = document.getElementById("note-title");
    const noteContentInput = document.getElementById("note-content");
    const noteImageInput = document.getElementById("note-image");
    const notePreviewImage = document.getElementById("note-preview-image");
    const noteFontSizeSelect = document.getElementById("note-font-size");
    const noteFontWeightSelect = document.getElementById("note-font-weight");
    const noteColorInput = document.getElementById("note-color");
    const saveNoteBtn = document.getElementById("save-note-btn");
    const deleteNoteBtn = document.getElementById("delete-note-btn");
    const editorTitleLabel = document.getElementById("editor-title-label");
    const editorSubLabel = document.getElementById("editor-sub-label");

    /*************** 1. ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ / Ø§Ù„Ø®Ø±ÙˆØ¬ ***************/
    googleLoginBtn.addEventListener("click", async () => {
      try {
        await signInWithPopup(auth, provider);
      } catch (err) {
        alert("ØµØ§Ø± Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ø­Ø³Ø§Ø¨ Google: " + err.message);
        console.error(err);
      }
    });

    logoutBtn.addEventListener("click", async () => {
      try {
        await signOut(auth);
      } catch (err) {
        console.error(err);
      }
    });

    onAuthStateChanged(auth, async (user) => {
      if (user) {
        currentUser = user;
        authScreen.classList.add("hidden");
        appShell.classList.remove("hidden");

        await saveUserProfile(user);
        applyUserInfoToUI(user);
        setGreeting(user);
        loadThemeFromLocal();
        await loadWidgets();
        await loadNotes();
      } else {
        currentUser = null;
        appShell.classList.add("hidden");
        authScreen.classList.remove("hidden");
      }
    });

    async function saveUserProfile(user) {
      const userRef = doc(db, "users", user.uid);
      const snap = await getDoc(userRef);
      if (!snap.exists()) {
        await setDoc(userRef, {
          displayName: user.displayName || "",
          email: user.email || "",
          photoURL: user.photoURL || "",
          createdAt: serverTimestamp()
        });
      } else {
        // ØªØ­Ø¯ÙŠØ« Ø¨Ø³ÙŠØ· Ù„Ù„Ø§Ø³Ù…/Ø§Ù„ØµÙˆØ±Ø© Ù„Ùˆ ØªØºÙŠÙ‘Ø±ÙˆØ§
        await updateDoc(userRef, {
          displayName: user.displayName || "",
          photoURL: user.photoURL || ""
        }).catch(() => {});
      }
    }

    function applyUserInfoToUI(user) {
      const name = user.displayName || "Ø¨Ø¯ÙˆÙ† Ø§Ø³Ù…";
      userNameEl.textContent = name;
      userEmailEl.textContent = user.email || "";

      const firstLetter = (name[0] || "A").toUpperCase();
      userAvatarFallback.textContent = firstLetter;

      if (user.photoURL) {
        userAvatarImg.src = user.photoURL;
        userAvatarImg.style.display = "block";
        userAvatarFallback.style.display = "none";
      } else {
        userAvatarImg.style.display = "none";
        userAvatarFallback.style.display = "flex";
      }
    }

    function setGreeting(user) {
      const hours = new Date().getHours();
      let greetingText = "Ù…Ø±Ø­Ø¨Ø§Ù‹";
      if (hours >= 5 && hours < 12) greetingText = "ØµØ¨Ø§Ø­ Ø§Ù„Ø®ÙŠØ±";
      else if (hours >= 12 && hours < 18) greetingText = "Ù…Ø³Ø§Ø¡ Ø§Ù„Ø®ÙŠØ±";
      else greetingText = "Ø³Ù‡Ø±Ø© Ù…ÙˆÙÙ‘Ù‚Ø©";

      const name = user.displayName ? user.displayName.split(" ")[0] : "ØµØ¯ÙŠÙ‚ÙŠ";
      greetingEl.innerHTML = `${greetingText}ØŒ <span>${name}</span> ğŸ‘‹`;
    }

    /*************** 2. Ø§Ù„Ø«ÙŠÙ… (Ø¯Ø§ÙƒÙ† / ÙØ§ØªØ­ / OLED) ***************/
    themeButtons.forEach((btn) => {
      btn.addEventListener("click", () => {
        const theme = btn.dataset.theme;
        setTheme(theme);
      });
    });

    function setTheme(theme) {
      document.body.classList.remove("theme-dark", "theme-light", "theme-oled");
      if (theme === "light") document.body.classList.add("theme-light");
      else if (theme === "oled") document.body.classList.add("theme-oled");
      else document.body.classList.add("theme-dark");

      themeButtons.forEach((b) => b.classList.remove("active"));
      document.querySelector(`.theme-btn[data-theme="${theme}"]`).classList.add("active");
      localStorage.setItem("atlas-theme", theme);
    }

    function loadThemeFromLocal() {
      const saved = localStorage.getItem("atlas-theme") || "dark";
      setTheme(saved);
    }

    /*************** 3. ÙˆÙŠØ¯Ø¬Øª Ø§Ù„Ù…Ø§Ø¡ / Ø§Ù„Ù†ÙˆÙ… / Ø§Ù„ØµÙ„Ø§Ø© / Ø§Ù„Ø¬ÙŠÙ… ***************/
    async function loadWidgets() {
      if (!currentUser) return;
      const ref = doc(db, "users", currentUser.uid, "meta", "widgets");
      const snap = await getDoc(ref);
      let data;
      if (snap.exists()) {
        data = snap.data();
      } else {
        data = { water: 0, sleep: 0, prayer: 0, gym: 0 };
        await setDoc(ref, data);
      }
      Object.keys(widgetsConfig).forEach((key) => {
        updateWidgetUI(key, data[key] || 0);
      });
    }

    async function saveWidgetsPartial(newValues) {
      if (!currentUser) return;
      const ref = doc(db, "users", currentUser.uid, "meta", "widgets");
      await setDoc(ref, newValues, { merge: true });
    }

    function updateWidgetUI(key, value) {
      const config = widgetsConfig[key];
      const valueEl = document.getElementById(`${key}-value`);
      const progressEl = document.getElementById(`${key}-progress`);

      if (!config) return;
      valueEl.textContent = `${value} / ${config.target} ${config.label}`;
      const ratio = Math.min(1, Math.max(0, value / config.target));
      if (progressEl) progressEl.style.width = (ratio * 100).toFixed(0) + "%";
    }

    document.querySelectorAll(".widget-card").forEach((card) => {
      const key = card.dataset.widget;
      const config = widgetsConfig[key];
      card.querySelectorAll(".widget-btn").forEach((btn) => {
        btn.addEventListener("click", async () => {
          if (!currentUser) return;
          const ref = doc(db, "users", currentUser.uid, "meta", "widgets");
          const snap = await getDoc(ref);
          let data = snap.exists() ? snap.data() : { water: 0, sleep: 0, prayer: 0, gym: 0 };
          let current = data[key] || 0;

          const action = btn.dataset.action;
          if (action === "plus") current++;
          if (action === "minus") current = Math.max(0, current - 1);
          if (action === "reset") current = 0;

          // Ù„Ø§ Ù†ØªØ¬Ø§ÙˆØ² Ø§Ù„Ù‡Ø¯Ù ÙƒØ«ÙŠØ±Ø§Ù‹
          current = Math.min(current, config.target * 2);
          data[key] = current;

          await saveWidgetsPartial({ [key]: current });
          updateWidgetUI(key, current);
        });
      });
    });

    /*************** 4. Ø§Ù„Ù†ÙˆØªØ§Øª ***************/
    function resetEditor() {
      currentNoteId = null;
      editorTitleLabel.textContent = "Ø¥Ù†Ø´Ø§Ø¡ Ù†ÙˆØªØ© Ø¬Ø¯ÙŠØ¯Ø©";
      editorSubLabel.textContent = "Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø¹Ù†ÙˆØ§Ù† ÙˆØ§Ù„Ù…Ø­ØªÙˆÙ‰â€¦ Ø«Ù… Ø§Ø­ÙØ¸Ù‡Ø§ Ù„ØªØ¸Ù‡Ø± ÙÙŠ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù†ÙˆØªØ§Øª.";
      noteTitleInput.value = "";
      noteContentInput.value = "";
      noteImageInput.value = "";
      notePreviewImage.style.display = "none";
      noteFontSizeSelect.value = "16";
      noteFontWeightSelect.value = "600";
      noteColorInput.value = "#e5e7eb";
      deleteNoteBtn.style.display = "none";
    }

    newNoteBtn.addEventListener("click", resetEditor);

    noteImageInput.addEventListener("input", () => {
      const url = noteImageInput.value.trim();
      if (url) {
        notePreviewImage.src = url;
        notePreviewImage.style.display = "block";
      } else {
        notePreviewImage.style.display = "none";
      }
    });

    async function loadNotes() {
      if (!currentUser) return;
      notesContainer.innerHTML = "<div class='small-helper'>Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù†ÙˆØªØ§Øªâ€¦</div>";
      const notesRef = collection(db, "users", currentUser.uid, "notes");
      const q = query(notesRef, orderBy("updatedAt", "desc"));
      const snap = await getDocs(q);
      if (snap.empty) {
        notesContainer.innerHTML = "<div class='small-helper'>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ÙˆØªØ§Øª Ø¨Ø¹Ø¯. Ø£Ù†Ø´Ø¦ Ø£ÙˆÙ„ Ù†ÙˆØªØ© Ù…Ù† Ø²Ø± â€œÙ†ÙˆØªØ© Ø¬Ø¯ÙŠØ¯Ø©â€.</div>";
        return;
      }
      notesContainer.innerHTML = "";
      snap.forEach((docSnap) => {
        const note = docSnap.data();
        const card = document.createElement("div");
        card.className = "note-card";
        card.dataset.id = docSnap.id;
        card.dataset.fontSize = note.fontSize || 16;
        card.dataset.fontWeight = note.fontWeight || 600;
        card.dataset.color = note.textColor || "#e5e7eb";

        const updatedDate = note.updatedAt?.toDate ? note.updatedAt.toDate() : new Date();
        const timeStr = updatedDate.toLocaleString("ar-EG", {
          month: "short",
          day: "numeric",
          hour: "numeric",
          minute: "2-digit"
        });

        card.innerHTML = `
          <div class="note-card-header">
            <div class="note-card-title">
              <span>${note.icon || "ğŸ—’ï¸"}</span>
              <span>${note.title || "Ù†ÙˆØªØ© Ø¨Ø¯ÙˆÙ† Ø¹Ù†ÙˆØ§Ù†"}</span>
            </div>
            <span class="note-chip">${note.category || "Ø¹Ø§Ù…"}</span>
          </div>
          <div class="note-card-snippet" style="font-size:${(note.fontSize || 16) - 2}px; color:${note.textColor || "#e5e7eb"}; font-weight:${note.fontWeight || 600};">
            ${note.content ? note.content.slice(0, 110) + (note.content.length > 110 ? "â€¦" : "") : "Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø­ØªÙˆÙ‰ Ø¨Ø¹Ø¯."}
          </div>
          <div class="note-card-meta">
            <span>Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«: ${timeStr}</span>
            <span>${note.pin ? "ğŸ“Œ Ù…Ø«Ø¨Øª" : ""}</span>
          </div>
        `;

        card.addEventListener("click", () => {
          openNoteInEditor(docSnap.id, note);
        });

        notesContainer.appendChild(card);
      });
    }

    function openNoteInEditor(id, note) {
      currentNoteId = id;
      editorTitleLabel.textContent = "ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù†ÙˆØªØ©";
      editorSubLabel.textContent = "Ø¹Ø¯Ù‘Ù„ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø£Ùˆ Ø§Ù„ØªÙ†Ø³ÙŠÙ‚ Ø«Ù… Ø§Ø¶ØºØ· Ø­ÙØ¸ Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù†ÙˆØªØ©.";
      noteTitleInput.value = note.title || "";
      noteContentInput.value = note.content || "";
      noteImageInput.value = note.imageUrl || "";
      if (note.imageUrl) {
        notePreviewImage.src = note.imageUrl;
        notePreviewImage.style.display = "block";
      } else {
        notePreviewImage.style.display = "none";
      }
      noteFontSizeSelect.value = String(note.fontSize || 16);
      noteFontWeightSelect.value = String(note.fontWeight || 600);
      noteColorInput.value = note.textColor || "#e5e7eb";
      deleteNoteBtn.style.display = "inline-flex";
    }

    saveNoteBtn.addEventListener("click", async () => {
      if (!currentUser) {
        alert("ÙŠÙ„Ø²Ù… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„Ø­ÙØ¸ Ø§Ù„Ù†ÙˆØªØ§Øª.");
        return;
      }
      const title = noteTitleInput.value.trim();
      const content = noteContentInput.value.trim();
      const imageUrl = noteImageInput.value.trim();
      const fontSize = parseInt(noteFontSizeSelect.value, 10) || 16;
      const fontWeight = parseInt(noteFontWeightSelect.value, 10) || 600;
      const textColor = noteColorInput.value || "#e5e7eb";

      if (!title && !content) {
        alert("Ø§ÙƒØªØ¨ Ø¹Ù†ÙˆØ§Ù†Ø§Ù‹ Ø£Ùˆ Ù…Ø­ØªÙˆÙ‰ Ù‚Ø¨Ù„ Ø§Ù„Ø­ÙØ¸.");
        return;
      }

      const notesRef = collection(db, "users", currentUser.uid, "notes");

      const payload = {
        title: title || "Ù†ÙˆØªØ© Ø¨Ø¯ÙˆÙ† Ø¹Ù†ÙˆØ§Ù†",
        content,
        imageUrl,
        fontSize,
        fontWeight,
        textColor,
        icon: "ğŸ—’ï¸",
        category: "Ø¹Ø§Ù…",
        updatedAt: serverTimestamp()
      };

      if (currentNoteId) {
        const ref = doc(db, "users", currentUser.uid, "notes", currentNoteId);
        await updateDoc(ref, payload);
      } else {
        payload.createdAt = serverTimestamp();
        await addDoc(notesRef, payload);
      }

      await loadNotes();
      resetEditor();
    });

    deleteNoteBtn.addEventListener("click", async () => {
      if (!currentUser || !currentNoteId) return;
      const confirmDelete = confirm("Ù…ØªØ£ÙƒØ¯ Ø¥Ù†Ùƒ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„Ù†ÙˆØªØ© Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ØŸ");
      if (!confirmDelete) return;
      const ref = doc(db, "users", currentUser.uid, "notes", currentNoteId);
      await deleteDoc(ref);
      await loadNotes();
      resetEditor();
    });

    // ØªÙ‡ÙŠØ¦Ø© Ø£ÙˆÙ„ÙŠØ©
    resetEditor();
    loadThemeFromLocal();
  </script>
</body>
</html>
<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ATLAS Workspace â€“ Ù…Ø³Ø§Ø­Ø© Ù…Ø­Ù…ÙˆØ¯ Ø§Ù„ØµÙ…Ø§Ø¯ÙŠ Ø§Ù„ÙŠÙˆÙ…ÙŠØ©</title>

  <!-- Ø®Ø·ÙˆØ· Ø¹Ø±Ø¨ÙŠØ© ÙˆØ¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ© Ø¨Ø³ÙŠØ·Ø© -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&family=Nunito:wght@400;600;700&display=swap" rel="stylesheet">

  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    html, body {
      height: 100%;
    }

    body {
      font-family: "Cairo", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: var(--bg);
      color: var(--text-main);
      line-height: 1.6;
      transition: background 0.3s ease, color 0.3s ease;
    }

    /* Ø§Ù„Ø«ÙŠÙ…Ø§Øª */
    body.theme-dark {
      --bg: #020617;
      --bg-soft: #020617;
      --card: #020617;
      --card-soft: #020617;
      --border-subtle: #1e293b;
      --accent: #0ea5e9;
      --accent-soft: rgba(14,165,233,0.1);
      --accent-strong: #0284c7;
      --text-main: #e5e7eb;
      --text-soft: #9ca3af;
      --danger: #f97373;
    }

    body.theme-light {
      --bg: #f3f4f6;
      --bg-soft: #e5e7eb;
      --card: #ffffff;
      --card-soft: #f9fafb;
      --border-subtle: #d1d5db;
      --accent: #2563eb;
      --accent-soft: rgba(37,99,235,0.08);
      --accent-strong: #1d4ed8;
      --text-main: #111827;
      --text-soft: #6b7280;
      --danger: #dc2626;
    }

    body.theme-oled {
      --bg: #000000;
      --bg-soft: #020617;
      --card: #020617;
      --card-soft: #020617;
      --border-subtle: #111827;
      --accent: #22d3ee;
      --accent-soft: rgba(34,211,238,0.12);
      --accent-strong: #06b6d4;
      --text-main: #f9fafb;
      --text-soft: #9ca3af;
      --danger: #fb7185;
    }

    a {
      color: inherit;
      text-decoration: none;
    }

    .app-shell {
      min-height: 100vh;
      max-width: 1200px;
      margin: 0 auto;
      padding: 16px 12px 32px;
    }

    /* Ø§Ù„Ù‡ÙŠØ¯Ø± */
    .topbar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 12px 16px;
      border-radius: 999px;
      background: linear-gradient(135deg, rgba(14,165,233,0.25), rgba(79,70,229,0.25));
      border: 1px solid rgba(148,163,184,0.4);
      box-shadow: 0 18px 45px rgba(15,23,42,0.7);
      margin-bottom: 20px;
      backdrop-filter: blur(16px);
    }

    .brand {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .brand-avatar {
      width: 38px;
      height: 38px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      background: radial-gradient(circle at 20% 0%, #22d3ee, #0f172a);
      color: #e5faff;
      font-weight: 700;
      font-size: 18px;
    }

    .brand-text-title {
      font-size: 18px;
      font-weight: 700;
    }

    .brand-text-sub {
      font-size: 11px;
      color: var(--text-soft);
    }

    .topbar-right {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .pill {
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,0.6);
      background: rgba(15,23,42,0.65);
      padding: 4px 8px;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      font-size: 11px;
      color: #e5e7eb;
    }

    .select {
      border-radius: 999px;
      border: 1px solid var(--border-subtle);
      background: rgba(15,23,42,0.9);
      color: var(--text-main);
      padding: 4px 10px;
      font-size: 12px;
      outline: none;
      cursor: pointer;
    }

    .ghost-btn {
      border-radius: 999px;
      border: 1px solid rgba(248,113,113,0.6);
      background: rgba(127,29,29,0.08);
      color: #fecaca;
      padding: 4px 12px;
      font-size: 12px;
      cursor: pointer;
      transition: background 0.2s ease, transform 0.1s ease;
    }

    .ghost-btn:hover {
      background: rgba(248,113,113,0.18);
      transform: translateY(-1px);
    }

    /* Ø§Ù„Ù„ÙŠØ§ÙˆØª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ */
    .main-layout {
      display: grid;
      grid-template-columns: minmax(0, 1.1fr) minmax(0, 1.4fr);
      gap: 18px;
    }

    @media (max-width: 900px) {
      .main-layout {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    .card {
      background: radial-gradient(circle at 0 0, rgba(148,163,184,0.25), rgba(15,23,42,0.98));
      border-radius: 18px;
      padding: 14px 14px 16px;
      border: 1px solid rgba(30,64,175,0.4);
      box-shadow: 0 18px 45px rgba(15,23,42,0.9);
      position: relative;
      overflow: hidden;
    }

    .card-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 10px;
    }

    .card-title {
      font-size: 15px;
      font-weight: 700;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .card-sub {
      font-size: 11px;
      color: var(--text-soft);
    }

    .badge {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      border-radius: 999px;
      padding: 2px 8px;
      font-size: 10px;
      background: rgba(15,23,42,0.8);
      border: 1px solid rgba(148,163,184,0.6);
      color: #e5e7eb;
    }

    /* ÙƒØ±Øª Ø§Ù„ØªØ±Ø­ÙŠØ¨ */
    .greeting-main {
      display: flex;
      flex-direction: column;
      gap: 8px;
      margin-top: 4px;
    }

    .greeting-line {
      font-size: 20px;
      font-weight: 700;
    }

    .greeting-name {
      color: var(--accent);
    }

    .greeting-meta {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      font-size: 11px;
      color: var(--text-soft);
      align-items: center;
      margin-top: 4px;
    }

    .greeting-meta span {
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    /* Ø§Ù„ÙˆØ¯Ø¬Ø§Øª */
    .widgets-grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 10px;
      margin-top: 12px;
    }

    .widget {
      background: rgba(15,23,42,0.85);
      border-radius: 14px;
      border: 1px solid var(--border-subtle);
      padding: 10px 10px 12px;
      font-size: 11px;
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .widget-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 6px;
    }

    .widget-title {
      display: flex;
      align-items: center;
      gap: 4px;
      font-weight: 600;
      font-size: 11px;
    }

    .widget-body {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .progress-bar {
      width: 100%;
      height: 6px;
      border-radius: 999px;
      background: rgba(15,23,42,0.9);
      overflow: hidden;
      border: 1px solid rgba(15,118,110,0.7);
    }

    .progress-bar-fill {
      height: 100%;
      width: 0;
      border-radius: inherit;
      background: linear-gradient(90deg, #22c55e, #a3e635);
      transition: width 0.2s ease;
    }

    .widget-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 6px;
    }

    .small-btn {
      border-radius: 999px;
      border: 1px solid var(--border-subtle);
      background: rgba(15,23,42,0.9);
      color: var(--text-main);
      padding: 2px 8px;
      font-size: 11px;
      cursor: pointer;
      min-width: 30px;
      text-align: center;
    }

    .small-btn:hover {
      background: rgba(30,64,175,0.8);
      border-color: rgba(96,165,250,0.8);
    }

    .small-input {
      width: 70px;
      border-radius: 999px;
      border: 1px solid var(--border-subtle);
      background: rgba(15,23,42,0.9);
      color: var(--text-main);
      padding: 2px 8px;
      font-size: 11px;
      outline: none;
      text-align: center;
    }

    .prayer-list {
      display: flex;
      flex-wrap: wrap;
      gap: 4px;
      font-size: 10px;
    }

    .prayer-chip {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      border-radius: 999px;
      padding: 1px 6px;
      background: rgba(15,23,42,0.9);
      border: 1px solid var(--border-subtle);
    }

    .prayer-chip input {
      accent-color: var(--accent);
    }

    .switch-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 6px;
      font-size: 11px;
    }

    /* Ø§Ù„Ù†ÙˆØªØ§Øª */
    .notes-card {
      background: radial-gradient(circle at 100% 0, rgba(56,189,248,0.22), rgba(15,23,42,0.97));
    }

    .notes-header-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      margin: 6px 0 8px;
    }

    .notes-header-main {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .notes-header-title {
      font-size: 16px;
      font-weight: 700;
    }

    .notes-header-sub {
      font-size: 11px;
      color: var(--text-soft);
    }

    .primary-btn {
      border-radius: 999px;
      border: none;
      background: linear-gradient(135deg, var(--accent), var(--accent-strong));
      color: white;
      padding: 6px 14px;
      font-size: 12px;
      font-weight: 600;
      cursor: pointer;
      box-shadow: 0 10px 25px rgba(15,23,42,0.7);
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .primary-btn:hover {
      filter: brightness(1.05);
      transform: translateY(-1px);
    }

    .notes-grid {
      margin-top: 6px;
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(190px, 1fr));
      gap: 10px;
    }

    .note-card {
      background: var(--card-soft);
      border-radius: 14px;
      border: 1px solid rgba(15,23,42,0.8);
      overflow: hidden;
      display: flex;
      flex-direction: column;
      min-height: 140px;
    }

    .note-cover {
      height: 70px;
      background-size: cover;
      background-position: center;
    }

    .note-body {
      padding: 8px 10px 6px;
      flex: 1;
    }

    .note-title {
      font-size: 13px;
      font-weight: 700;
      margin-bottom: 4px;
    }

    .note-content {
      font-size: 11px;
      color: var(--text-soft);
      max-height: 90px;
      overflow: hidden;
    }

    .note-actions {
      display: flex;
      justify-content: space-between;
      gap: 4px;
      padding: 4px 7px 8px;
    }

    .note-actions button {
      flex: 1;
      border-radius: 999px;
      border: 1px solid var(--border-subtle);
      background: rgba(15,23,42,0.9);
      color: var(--text-main);
      font-size: 11px;
      padding: 2px 0;
      cursor: pointer;
    }

    .note-actions button:hover {
      background: rgba(37,99,235,0.9);
      border-color: rgba(96,165,250,0.9);
    }

    .note-actions button:nth-child(2):hover {
      background: rgba(220,38,38,0.9);
      border-color: rgba(248,113,113,0.95);
    }

    .empty-text {
      font-size: 12px;
      color: var(--text-soft);
      padding-top: 10px;
    }

    /* ÙƒØ±Øª Ø§Ù„Ø£ÙÙƒØ§Ø± */
    .gallery-card {
      margin-top: 14px;
      background: radial-gradient(circle at 0 0, rgba(251,191,36,0.22), rgba(15,23,42,0.96));
    }

    .gallery-list {
      margin-top: 6px;
      font-size: 11px;
      color: var(--text-soft);
      display: grid;
      gap: 4px;
    }

    .gallery-list li {
      margin-right: 14px;
    }

    /* Ø§Ù„ÙÙˆØªØ± */
    .footer {
      margin-top: 18px;
      font-size: 11px;
      color: var(--text-soft);
      text-align: center;
    }

    .footer strong {
      color: var(--accent);
    }

    /* Ø§Ù„Ø£ÙˆÙØ±Ù„Ø§ÙŠ (ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ + Ù…ÙˆØ¯Ø§Ù„ Ø§Ù„Ù†ÙˆØªØ§Øª) */
    .overlay {
      position: fixed;
      inset: 0;
      background: rgba(15,23,42,0.78);
      backdrop-filter: blur(14px);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 40;
    }

    .overlay.hidden {
      display: none;
    }

    .login-card, .modal-card {
      width: 100%;
      max-width: 380px;
      background: radial-gradient(circle at 50% 0, rgba(56,189,248,0.22), rgba(15,23,42,0.97));
      border-radius: 18px;
      padding: 16px 18px 18px;
      border: 1px solid rgba(148,163,184,0.5);
      box-shadow: 0 20px 50px rgba(0,0,0,0.8);
    }

    .login-title {
      font-size: 18px;
      font-weight: 700;
      margin-bottom: 4px;
    }

    .login-sub {
      font-size: 11px;
      color: var(--text-soft);
      margin-bottom: 10px;
    }

    .form-group {
      margin-bottom: 10px;
      font-size: 12px;
    }

    .form-label {
      display: block;
      margin-bottom: 3px;
    }

    .form-input, .form-select, .form-textarea {
      width: 100%;
      border-radius: 12px;
      border: 1px solid var(--border-subtle);
      background: rgba(15,23,42,0.95);
      color: var(--text-main);
      padding: 7px 9px;
      font-size: 12px;
      outline: none;
    }

    .form-textarea {
      min-height: 100px;
      resize: vertical;
    }

    .form-row {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 8px;
    }

    .modal-actions {
      display: flex;
      justify-content: flex-end;
      gap: 8px;
      margin-top: 8px;
    }

    .secondary-btn {
      border-radius: 999px;
      border: 1px solid var(--border-subtle);
      background: rgba(15,23,42,0.95);
      color: var(--text-main);
      padding: 5px 14px;
      font-size: 12px;
      cursor: pointer;
    }

    .secondary-btn:hover {
      background: rgba(30,64,175,0.9);
      border-color: rgba(96,165,250,0.9);
    }

    .login-helper {
      margin-top: 6px;
      font-size: 10px;
      color: var(--text-soft);
    }

    @media (max-width: 600px) {
      .topbar {
        flex-direction: column;
        align-items: flex-start;
        gap: 8px;
        border-radius: 16px;
      }

      .topbar-right {
        width: 100%;
        justify-content: space-between;
      }
    }
  </style>
</head>
<body class="theme-dark">
  <div class="app-shell">
    <!-- Ø´Ø±ÙŠØ· Ø¹Ù„ÙˆÙŠ -->
    <header class="topbar">
      <div class="brand">
        <div class="brand-avatar">A</div>
        <div>
          <div class="brand-text-title">ATLAS Workspace</div>
          <div class="brand-text-sub">Ù…Ø³Ø§Ø­ØªÙƒ Ø§Ù„ÙŠÙˆÙ…ÙŠØ© Ù„ØªÙ†Ø¸ÙŠÙ… Ø­ÙŠØ§ØªÙƒ â€“ Ù…Ù† ØµÙ†Ø¹ Ù…Ø­Ù…ÙˆØ¯ Ø§Ù„ØµÙ…Ø§Ø¯ÙŠ</div>
        </div>
      </div>
      <div class="topbar-right">
        <div class="pill">
          <span>ÙˆØ¶Ø¹:</span>
          <select id="theme-select" class="select">
            <option value="dark">Ø¯Ø§ÙƒÙ†</option>
            <option value="light">ÙØ§ØªØ­</option>
            <option value="oled">Ø£Ø³ÙˆØ¯ OLED</option>
          </select>
        </div>
        <button id="logout-btn" class="ghost-btn">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>
      </div>
    </header>

    <main class="main-layout">
      <!-- Ø§Ù„Ø¹Ù…ÙˆØ¯ Ø§Ù„Ø£ÙŠØ³Ø±: ØªØ­ÙŠØ© + ÙˆØ¯Ø¬Ø§Øª -->
      <section>
        <article class="card">
          <header class="card-header">
            <div>
              <div class="card-title">Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ğŸ‘‹</div>
              <div class="card-sub">Ù‡Ø°Ù‡ Ù…Ø³Ø§Ø­Ø© Ø´Ø®ØµÙŠØ© ÙŠÙˆÙ…ÙŠØ© ØªØ­ØªÙØ¸ Ø¨ÙƒÙ„ Ø´ÙŠØ¡ ÙŠØ®ØµÙƒ ÙÙŠ Ù…ÙƒØ§Ù† ÙˆØ§Ø­Ø¯.</div>
            </div>
            <div class="badge">
              <span style="width:7px;height:7px;border-radius:50%;background:#22c55e;"></span>
              <span id="status-text">ÙŠØ¹Ù…Ù„ Ø§Ù„Ø¢Ù†</span>
            </div>
          </header>

          <div class="greeting-main">
            <div class="greeting-line">
              <span id="greeting-text">ØµØ¨Ø§Ø­ Ø§Ù„Ø®ÙŠØ±</span>
              <span class="greeting-name" id="greeting-name">Ø¶ÙŠÙ</span> â˜•
            </div>
            <div class="greeting-meta">
              <span id="today-date"></span>
              <span>â€¢</span>
              <span>ÙƒÙ„ Ø´ÙŠØ¡ Ù…Ø­ÙÙˆØ¸ Ø¹Ù„Ù‰ Ø¬Ù‡Ø§Ø²ÙƒØŒ Ø¨Ø¯ÙˆÙ† Ø­Ø³Ø§Ø¨Ø§Øª Ù…Ø¹Ù‚Ø¯Ø©.</span>
            </div>
          </div>

          <!-- ÙˆØ¯Ø¬Ø§Øª -->
          <div class="widgets-grid">
            <!-- Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ù…Ø§Ø¡ -->
            <div class="widget">
              <div class="widget-header">
                <div class="widget-title">ğŸ’§ Ù…ÙŠØ§Ù‡</div>
                <div style="font-size:10px;color:var(--text-soft);">
                  <span id="water-percent">0%</span> Ù…Ù† Ù‡Ø¯ÙÙƒ
                </div>
              </div>
              <div class="widget-body">
                <div class="progress-bar">
                  <div id="water-bar-fill" class="progress-bar-fill"></div>
                </div>
                <div class="widget-row">
                  <span style="font-size:11px;">Ø¹Ø¯Ø¯ Ø§Ù„Ø£ÙƒÙˆØ§Ø¨ Ø§Ù„ÙŠÙˆÙ…:</span>
                  <strong id="water-count">0</strong>
                </div>
                <div class="widget-row">
                  <button id="water-minus" class="small-btn">â€“</button>
                  <button id="water-plus" class="small-btn">+</button>
                </div>
              </div>
            </div>

            <!-- Ø§Ù„Ù†ÙˆÙ… -->
            <div class="widget">
              <div class="widget-header">
                <div class="widget-title">ğŸ˜´ Ù†ÙˆÙ…</div>
                <div style="font-size:10px;color:var(--text-soft);">Ø¢Ø®Ø± Ù„ÙŠÙ„Ø©</div>
              </div>
              <div class="widget-body">
                <div class="widget-row">
                  <span style="font-size:11px;">Ø¹Ø¯Ø¯ Ø§Ù„Ø³Ø§Ø¹Ø§Øª:</span>
                  <input id="sleep-hours" type="number" min="0" max="24" step="0.5" class="small-input" />
                </div>
                <div id="sleep-label" style="font-size:10px;color:var(--text-soft);">
                  Ù„Ù… ØªØ³Ø¬Ù‘Ù„ Ù†ÙˆÙ…Ùƒ Ø¨Ø¹Ø¯
                </div>
              </div>
            </div>

            <!-- Ø§Ù„ØµÙ„Ø§Ø© -->
            <div class="widget">
              <div class="widget-header">
                <div class="widget-title">ğŸ•Œ ØµÙ„Ø§Ø©</div>
                <div id="prayer-summary" style="font-size:10px;color:var(--text-soft);">0 / 5 ØµÙ„ÙˆØ§Øª</div>
              </div>
              <div class="widget-body">
                <div class="prayer-list">
                  <label class="prayer-chip">
                    <input type="checkbox" data-prayer="fajr" /> ÙØ¬Ø±
                  </label>
                  <label class="prayer-chip">
                    <input type="checkbox" data-prayer="dhuhr" /> Ø¸Ù‡Ø±
                  </label>
                  <label class="prayer-chip">
                    <input type="checkbox" data-prayer="asr" /> Ø¹ØµØ±
                  </label>
                  <label class="prayer-chip">
                    <input type="checkbox" data-prayer="maghrib" /> Ù…ØºØ±Ø¨
                  </label>
                  <label class="prayer-chip">
                    <input type="checkbox" data-prayer="isha" /> Ø¹Ø´Ø§Ø¡
                  </label>
                </div>
              </div>
            </div>

            <!-- Ø§Ù„Ø¬ÙŠÙ… -->
            <div class="widget">
              <div class="widget-header">
                <div class="widget-title">ğŸ‹ï¸ Ø¬ÙŠÙ… / Ø­Ø±ÙƒØ©</div>
                <div style="font-size:10px;color:var(--text-soft);">Ø§Ù„ÙŠÙˆÙ…</div>
              </div>
              <div class="widget-body">
                <div class="switch-row">
                  <span id="gym-label">Ù„Ù… ØªØ³Ø¬Ù‘Ù„ ØªÙ…Ø±ÙŠÙ† Ø§Ù„ÙŠÙˆÙ… Ø¨Ø¹Ø¯</span>
                  <input id="gym-done" type="checkbox" />
                </div>
              </div>
            </div>
          </div>
        </article>
      </section>

      <!-- Ø§Ù„Ø¹Ù…ÙˆØ¯ Ø§Ù„Ø£ÙŠÙ…Ù†: Ø§Ù„Ù†ÙˆØªØ§Øª + Ø§Ù„Ø£ÙÙƒØ§Ø± -->
      <section>
        <article class="card notes-card">
          <header class="notes-header-row">
            <div class="notes-header-main">
              <div class="notes-header-title">Ù†ÙˆØªØ§ØªÙƒ Ø§Ù„ÙŠÙˆÙ…ÙŠØ© âœï¸</div>
              <div class="notes-header-sub">
                Ø£Ù†Ø´Ø¦ ØµÙØ­Ø§Øª Ù…Ø®ØµÙ‘ØµØ© Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ ÙƒÙ…Ø§ ØªØ­Ø¨ â€“ ØºÙŠÙ‘Ø± Ø§Ù„Ø£Ù„ÙˆØ§Ù†ØŒ Ù†ÙˆØ¹ Ø§Ù„Ø®Ø·ØŒ Ø­Ø¬Ù… Ø§Ù„Ù†ØµØŒ ÙˆØ£Ø¶Ù ØµÙˆØ±Ø© Ù„ÙƒÙ„ Ù†ÙˆØªØ©.
              </div>
            </div>
            <button id="new-note-btn" class="primary-btn">
              + Ù…Ù„Ø§Ø­Ø¸Ø© Ø¬Ø¯ÙŠØ¯Ø©
            </button>
          </header>

          <div class="notes-grid" id="notes-grid">
            <!-- Ø§Ù„Ù†ÙˆØªØ§Øª ØªØªÙˆÙ„Ù‘Ø¯ Ù‡Ù†Ø§ -->
          </div>
        </article>

        <article class="card gallery-card">
          <header class="card-header">
            <div>
              <div class="card-title">Ù…Ø¹Ø±Ø¶ Ø§Ù„Ø£ÙÙƒØ§Ø± ğŸ’¡</div>
              <div class="card-sub">Ù…Ø³Ø§Ø­Ø© Ø¥Ù„Ù‡Ø§Ù… Ù„ØªØ¬Ø§Ø±Ø¨Ùƒ Ù…Ø¹ Ø§Ù„Ù†ÙˆØªØ§Øª â€“ ØªÙ…Ø§Ù…Ø§Ù‹ Ù…Ø«Ù„ Ø§Ù„ØµÙˆØ± Ø§Ù„Ù„ÙŠ Ø£Ø±Ø³Ù„ØªÙ‡Ø§ Ù…Ù† Notion.</div>
            </div>
          </header>
          <ul class="gallery-list">
            <li>Ø§ØµÙ†Ø¹ Ù†ÙˆØªØ© Ø¨Ø¹Ù†ÙˆØ§Ù† <strong>Ø®Ø·Ø© Ù…Ø§Ù„ÙŠØ©</strong>ØŒ Ø£Ø¶Ù ØµÙˆØ±Ø© Ø¨Ø³ÙŠØ·Ø©ØŒ ÙˆØ§Ø³ØªØ®Ø¯Ù… Ù„ÙˆÙ† Ø®Ù„ÙÙŠØ© Ø¯Ø§ÙƒÙ† ÙˆØ®Ø· ÙƒØ¨ÙŠØ± Ù„Ù„Ø¹Ù†Ø§ÙˆÙŠÙ†.</li>
            <li>Ø§ØµÙ†Ø¹ Ù†ÙˆØªØ© Ø¨Ø¹Ù†ÙˆØ§Ù† <strong>Ù…Ø®Ø·Ø· Ø£Ø³Ø¨ÙˆØ¹ÙŠ</strong>ØŒ Ù‚Ø³Ù‘Ù… ÙÙŠÙ‡Ø§ Ø§Ù„Ø£ÙŠØ§Ù… ÙÙŠ Ø§Ù„Ù†ØµØŒ ÙˆØ§Ø³ØªØ®Ø¯Ù… Ù„ÙˆÙ† Ù…Ø®ØªÙ„Ù Ù„ÙƒÙ„ ÙŠÙˆÙ….</li>
            <li>Ø¬Ø±Ù‘Ø¨ Ù†ÙˆØªØ© Ø¨Ø¹Ù†ÙˆØ§Ù† <strong>Ø±ÙˆØªÙŠÙ† Ø§Ù„ØµØ¨Ø§Ø­</strong> Ø£Ùˆ <strong>Ø±ÙˆØªÙŠÙ† Ø§Ù„Ù†ÙˆÙ…</strong> ÙˆØ§Ø¶Ø¨Ø· Ù…Ø¹Ù‡Ø§ ÙˆØ¯Ø¬Ø§Øª Ø§Ù„Ù…Ø§Ø¡ / Ø§Ù„Ù†ÙˆÙ….</li>
            <li>Ø®Ø° Ù„Ù‚Ø·Ø© Ø´Ø§Ø´Ø© Ù„Ù†ÙˆØªØªÙƒ Ø§Ù„Ù…Ø¨Ø¯Ø¹Ø© ÙˆØ´Ø§Ø±ÙƒÙ‡Ø§ Ù…Ø¹ Ø£ØµØ­Ø§Ø¨Ùƒ â€“ Ù‡Ø°Ø§ ÙŠØ¬Ø¹Ù„ Ù…ÙˆÙ‚Ø¹Ùƒ Ø¬Ø²Ø¡ Ù…Ù† Ø±ÙˆØªÙŠÙ† Ø­ÙŠØ§ØªÙ‡Ù… Ø§Ù„ÙŠÙˆÙ…ÙŠ.</li>
          </ul>
        </article>
      </section>
    </main>

    <footer class="footer">
      ØµÙÙ…Ù‘Ù… ÙˆØ¨ÙÙ†ÙŠ Ø¨ØªØ¹Ø§ÙˆÙ† Ø¨ÙŠÙ† <strong>Ù…Ø­Ù…ÙˆØ¯ Ø§Ù„ØµÙ…Ø§Ø¯ÙŠ</strong> Ùˆ ATLAS Workspace.  
      ÙƒÙ„ Ø´ÙŠØ¡ ÙŠØ¹Ù…Ù„ Ù…Ù† Ø§Ù„Ù…ØªØµÙØ­ Ù…Ø¨Ø§Ø´Ø±Ø© Ø¨Ø¯ÙˆÙ† ØªØ«Ø¨ÙŠØª Ø£Ùˆ ØªØ³Ø¬ÙŠÙ„ Ù…Ø¹Ù‚Ø¯.
    </footer>
  </div>

  <!-- Ø´Ø§Ø´Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø¨Ø³ÙŠØ· -->
  <div id="login-overlay" class="overlay">
    <form id="login-form" class="login-card">
      <div class="login-title">Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ù…Ø³Ø§Ø­Ø© Ù…Ø­Ù…ÙˆØ¯ ğŸŒ™</div>
      <div class="login-sub">
        Ø£Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ ÙˆØ¥ÙŠÙ…ÙŠÙ„Ùƒ ÙÙ‚Ø· Ù„Ø¹Ø±Ø¶ ØªØ­ÙŠØ© Ø´Ø®ØµÙŠØ© ÙˆØ­ÙØ¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§ØªÙƒ Ø¹Ù„Ù‰ Ù‡Ø°Ø§ Ø§Ù„Ø¬Ù‡Ø§Ø².
      </div>

      <div class="form-group">
        <label class="form-label" for="login-name">Ø§Ù„Ø§Ø³Ù…</label>
        <input id="login-name" class="form-input" placeholder="Ù…Ø«Ø§Ù„: Ù…Ø­Ù…ÙˆØ¯" />
      </div>

      <div class="form-group">
        <label class="form-label" for="login-email">Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„</label>
        <input id="login-email" type="email" class="form-input" placeholder="example@email.com" />
      </div>

      <button type="submit" class="primary-btn" style="width:100%;justify-content:center;margin-top:6px;">
        Ø¯Ø®ÙˆÙ„ Ø¥Ù„Ù‰ Ù…Ø³Ø§Ø­ØªÙŠ
      </button>

      <div class="login-helper">
        â‡¢ Ù‡Ø°Ø§ ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ù…Ø­Ù„ÙŠ ÙÙ‚Ø· (local). Ø¨ÙŠØ§Ù†Ø§ØªÙƒ ØªÙØ®Ø²Ù‘ÙÙ† ÙÙŠ Ù…ØªØµÙØ­Ùƒ Ø¹Ù„Ù‰ Ù‡Ø°Ø§ Ø§Ù„Ø¬Ù‡Ø§Ø²ØŒ ÙˆÙŠÙ…ÙƒÙ†Ùƒ Ø­Ø°ÙÙ‡Ø§ ÙÙŠ Ø£ÙŠ ÙˆÙ‚Øª Ù…Ù† Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…ØªØµÙØ­.
      </div>
    </form>
  </div>

  <!-- Ù…ÙˆØ¯Ø§Ù„ Ø¥Ù†Ø´Ø§Ø¡ / ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù†ÙˆØªØ© -->
  <div id="note-modal" class="overlay hidden">
    <form class="modal-card">
      <div class="login-title" style="margin-bottom:6px;">Ù…Ù„Ø§Ø­Ø¸Ø© Ø¬Ø¯ÙŠØ¯Ø© / ØªØ¹Ø¯ÙŠÙ„</div>
      <div class="login-sub">
        Ø®ØµÙ‘Øµ ÙƒÙ„ Ø´ÙŠØ¡ ÙÙŠ Ø§Ù„Ù†ÙˆØªØ©: Ø§Ù„Ø¹Ù†ÙˆØ§Ù†ØŒ Ø§Ù„Ù†ØµØŒ Ø§Ù„Ø£Ù„ÙˆØ§Ù†ØŒ Ù†ÙˆØ¹ Ø§Ù„Ø®Ø·ØŒ ÙˆØ­ØªÙ‰ ØµÙˆØ±Ø© Ø§Ù„ØºÙ„Ø§Ù Ù…Ø«Ù„ Notion.
      </div>

      <div class="form-group">
        <label class="form-label" for="note-title-input">Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù†ÙˆØªØ©</label>
        <input id="note-title-input" class="form-input" placeholder="Ù…Ø«Ø§Ù„: Ù…Ø®Ø·Ø· Ø£Ø³Ø¨ÙˆØ¹ÙŠØŒ Ø®Ø·Ø© Ø¯Ø±Ø§Ø³Ø©ØŒ Ø®Ø·Ø© Ù…Ø§Ù„ÙŠØ©..." />
      </div>

      <div class="form-group">
        <label class="form-label" for="note-content-input">Ø§Ù„Ù…Ø­ØªÙˆÙ‰</label>
        <textarea id="note-content-input" class="form-textarea" placeholder="Ø§ÙƒØªØ¨ Ù†ÙˆØªØªÙƒ Ù‡Ù†Ø§ØŒ ÙŠÙ…ÙƒÙ†Ùƒ ØªÙ‚Ø³ÙŠÙ…Ù‡Ø§ Ù„Ø£Ø³Ø·Ø± Ù…Ø«Ù„ Notion..."></textarea>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label class="form-label" for="note-bg-input">Ù„ÙˆÙ† Ø§Ù„Ø®Ù„ÙÙŠØ©</label>
          <input id="note-bg-input" type="color" class="form-input" />
        </div>
        <div class="form-group">
          <label class="form-label" for="note-color-input">Ù„ÙˆÙ† Ø§Ù„Ø®Ø·</label>
          <input id="note-color-input" type="color" class="form-input" />
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label class="form-label" for="note-font-input">Ù†ÙˆØ¹ Ø§Ù„Ø®Ø·</label>
          <select id="note-font-input" class="form-select form-input">
            <option value="Cairo">Cairo (Ø¹Ø±Ø¨ÙŠ Ù…Ø±ÙŠØ­)</option>
            <option value="Nunito">Nunito (Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ Ù†Ø§Ø¹Ù…)</option>
            <option value="system-ui">System UI</option>
          </select>
        </div>
        <div class="form-group">
          <label class="form-label" for="note-size-input">Ø­Ø¬Ù… Ø§Ù„Ø®Ø·</label>
          <input id="note-size-input" type="number" min="10" max="30" class="form-input" />
        </div>
      </div>

      <div class="form-group">
        <label class="form-label" for="note-image-input">Ø±Ø§Ø¨Ø· ØµÙˆØ±Ø© Ø§Ù„ØºÙ„Ø§Ù (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
        <input id="note-image-input" class="form-input" placeholder="Ø§Ù„ØµÙ‚ Ø±Ø§Ø¨Ø· ØµÙˆØ±Ø© Ù…Ù† Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª Ø£Ùˆ Ø§ØªØ±ÙƒÙ‡ ÙØ§Ø±ØºØ§Ù‹" />
      </div>

      <div class="modal-actions">
        <button id="note-cancel-btn" class="secondary-btn">Ø¥Ù„ØºØ§Ø¡</button>
        <button id="note-save-btn" class="primary-btn" type="submit">Ø­ÙØ¸</button>
      </div>
    </form>
  </div>

  <script>
    const $ = (sel) => document.querySelector(sel);
    const $$ = (sel) => document.querySelectorAll(sel);

    const defaultState = {
      theme: "dark",
      trackers: {
        water: 0,
        waterGoal: 8,
        sleepHours: 0,
        prayers: { fajr: false, dhuhr: false, asr: false, maghrib: false, isha: false },
        gymDone: false
      },
      notes: []
    };

    let currentUser = null;
    let state = JSON.parse(JSON.stringify(defaultState));
    let editingIndex = null;

    function getUserKey() {
      if (!currentUser) return null;
      return "atlas-life-" + currentUser.email;
    }

    function loadUserFromStorage() {
      const raw = localStorage.getItem("atlas-life-user");
      if (raw) {
        try {
          currentUser = JSON.parse(raw);
        } catch (e) {
          currentUser = null;
        }
      }
    }

    function saveUserToStorage() {
      if (currentUser) {
        localStorage.setItem("atlas-life-user", JSON.stringify(currentUser));
      } else {
        localStorage.removeItem("atlas-life-user");
      }
    }

    function loadState() {
      const key = getUserKey();
      if (!key) return;
      const raw = localStorage.getItem(key);
      if (raw) {
        try {
          const stored = JSON.parse(raw);
          state = Object.assign({}, defaultState, stored);
        } catch (e) {
          state = JSON.parse(JSON.stringify(defaultState));
        }
      } else {
        state = JSON.parse(JSON.stringify(defaultState));
      }
      applyTheme(state.theme || "dark");
      renderAll();
    }

    function saveState() {
      const key = getUserKey();
      if (!key) return;
      localStorage.setItem(key, JSON.stringify(state));
    }

    function applyTheme(theme) {
      document.body.classList.remove("theme-dark", "theme-light", "theme-oled");
      const cls = theme === "light" ? "theme-light" : theme === "oled" ? "theme-oled" : "theme-dark";
      document.body.classList.add(cls);
      const select = $("#theme-select");
      if (select) select.value = theme;
    }

    function getGreetingText() {
      const hour = new Date().getHours();
      if (hour < 12) return "ØµØ¨Ø§Ø­ Ø§Ù„Ø®ÙŠØ±";
      if (hour < 18) return "Ù…Ø³Ø§Ø¡ Ø§Ù„Ø®ÙŠØ±";
      return "Ù…Ø³Ø§Ø¡ Ø§Ù„Ø®ÙŠØ±";
    }

    function formatTodayDate() {
      const d = new Date();
      const days = ["Ø§Ù„Ø£Ø­Ø¯","Ø§Ù„Ø§Ø«Ù†ÙŠÙ†","Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡","Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡","Ø§Ù„Ø®Ù…ÙŠØ³","Ø§Ù„Ø¬Ù…Ø¹Ø©","Ø§Ù„Ø³Ø¨Øª"];
      const months = ["ÙŠÙ†Ø§ÙŠØ±","ÙØ¨Ø±Ø§ÙŠØ±","Ù…Ø§Ø±Ø³","Ø£Ø¨Ø±ÙŠÙ„","Ù…Ø§ÙŠÙˆ","ÙŠÙˆÙ†ÙŠÙˆ","ÙŠÙˆÙ„ÙŠÙˆ","Ø£ØºØ³Ø·Ø³","Ø³Ø¨ØªÙ…Ø¨Ø±","Ø£ÙƒØªÙˆØ¨Ø±","Ù†ÙˆÙÙ…Ø¨Ø±","Ø¯ÙŠØ³Ù…Ø¨Ø±"];
      const dayName = days[d.getDay()];
      const day = d.getDate();
      const month = months[d.getMonth()];
      const year = d.getFullYear();
      return `${dayName} â€¢ ${day} ${month} ${year}`;
    }

    function updateGreeting() {
      const greetEl = $("#greeting-text");
      const nameEl = $("#greeting-name");
      const dateEl = $("#today-date");
      if (greetEl) greetEl.textContent = getGreetingText();
      if (nameEl) nameEl.textContent = currentUser ? currentUser.name || "Ø¶ÙŠÙ" : "Ø¶ÙŠÙ";
      if (dateEl) dateEl.textContent = formatTodayDate();
    }

    function renderTrackers() {
      // Ù…Ø§Ø¡
      const water = state.trackers.water || 0;
      const goal = state.trackers.waterGoal || 8;
      const percent = goal > 0 ? Math.min(100, Math.round(water / goal * 100)) : 0;
      $("#water-count").textContent = water;
      $("#water-percent").textContent = percent + "%";
      $("#water-bar-fill").style.width = percent + "%";

      // Ù†ÙˆÙ…
      const sleepHoursInput = $("#sleep-hours");
      if (sleepHoursInput) {
        sleepHoursInput.value = state.trackers.sleepHours || "";
      }
      const sleepLabel = $("#sleep-label");
      if (sleepLabel) {
        sleepLabel.textContent = state.trackers.sleepHours
          ? `Ù†Ù…Øª ${state.trackers.sleepHours} Ø³Ø§Ø¹Ø©`
          : "Ù„Ù… ØªØ³Ø¬Ù‘Ù„ Ù†ÙˆÙ…Ùƒ Ø¨Ø¹Ø¯";
      }

      // ØµÙ„Ø§Ø©
      const prayers = state.trackers.prayers || {};
      ["fajr","dhuhr","asr","maghrib","isha"].forEach(key => {
        const cb = document.querySelector(`input[data-prayer="${key}"]`);
        if (cb) cb.checked = !!prayers[key];
      });
      const done = Object.values(prayers).filter(Boolean).length;
      const summary = $("#prayer-summary");
      if (summary) summary.textContent = `${done} / 5 ØµÙ„ÙˆØ§Øª`;

      // Ø¬ÙŠÙ…
      const gymToggle = $("#gym-done");
      if (gymToggle) {
        gymToggle.checked = !!state.trackers.gymDone;
      }
      const gymLabel = $("#gym-label");
      if (gymLabel) {
        gymLabel.textContent = state.trackers.gymDone
          ? "Ø£Ø­Ø³Ù†Øª! ØªÙ…Ø±Ù‘Ù†Øª Ø§Ù„ÙŠÙˆÙ… ğŸ’ª"
          : "Ù„Ù… ØªØ³Ø¬Ù‘Ù„ ØªÙ…Ø±ÙŠÙ† Ø§Ù„ÙŠÙˆÙ… Ø¨Ø¹Ø¯";
      }
    }

    function renderNotes() {
      const container = $("#notes-grid");
      if (!container) return;
      container.innerHTML = "";

      if (!state.notes || !state.notes.length) {
        container.innerHTML = '<p class="empty-text">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¨Ø¹Ø¯. Ø§Ø¶ØºØ· "Ù…Ù„Ø§Ø­Ø¸Ø© Ø¬Ø¯ÙŠØ¯Ø©" Ù„Ù„Ø¨Ø¯Ø¡ âœï¸</p>';
        return;
      }

      state.notes.forEach((note, index) => {
        const card = document.createElement("article");
        card.className = "note-card";
        card.style.backgroundColor = note.bg || "var(--card-soft)";
        card.style.color = note.color || "var(--text-main)";
        card.style.fontFamily = note.fontFamily || "Cairo";
        card.style.fontSize = (note.fontSize || 16) + "px";

        let html = "";
        if (note.image) {
          const safeUrl = note.image.replace(/'/g, "&#39;");
          html += `<div class="note-cover" style="background-image:url('${safeUrl}')"></div>`;
        }
        const safeTitle = note.title || "Ù…Ù„Ø§Ø­Ø¸Ø© Ø¨Ø¯ÙˆÙ† Ø¹Ù†ÙˆØ§Ù†";
        const safeContent = (note.content || "").replace(/\n/g, "<br>");

        html += `
          <div class="note-body">
            <h3 class="note-title">${safeTitle}</h3>
            <p class="note-content">${safeContent}</p>
          </div>
          <div class="note-actions">
            <button type="button" data-edit="${index}">ØªØ¹Ø¯ÙŠÙ„</button>
            <button type="button" data-delete="${index}">Ø­Ø°Ù</button>
          </div>
        `;
        card.innerHTML = html;
        container.appendChild(card);
      });
    }

    function renderAll() {
      updateGreeting();
      renderTrackers();
      renderNotes();
    }

    // Ù…ÙˆØ¯Ø§Ù„ Ø§Ù„Ù†ÙˆØªØ©
    function openNoteModal(index) {
      editingIndex = (index !== null && index !== undefined) ? index : null;
      const modal = $("#note-modal");
      modal.classList.remove("hidden");

      const note = (editingIndex !== null && state.notes[editingIndex])
        ? state.notes[editingIndex]
        : { title: "", content: "", bg: "#0f172a", color: "#f9fafb", fontFamily: "Cairo", fontSize: 16, image: "" };

      $("#note-title-input").value = note.title || "";
      $("#note-content-input").value = note.content || "";
      $("#note-bg-input").value = note.bg || "#0f172a";
      $("#note-color-input").value = note.color || "#f9fafb";
      $("#note-font-input").value = note.fontFamily || "Cairo";
      $("#note-size-input").value = note.fontSize || 16;
      $("#note-image-input").value = note.image || "";
    }

    function closeNoteModal() {
      $("#note-modal").classList.add("hidden");
      editingIndex = null;
    }

    function saveNoteFromModal() {
      const note = {
        title: $("#note-title-input").value.trim(),
        content: $("#note-content-input").value.trim(),
        bg: $("#note-bg-input").value || "#0f172a",
        color: $("#note-color-input").value || "#f9fafb",
        fontFamily: $("#note-font-input").value || "Cairo",
        fontSize: parseInt($("#note-size-input").value, 10) || 16,
        image: $("#note-image-input").value.trim()
      };

      if (editingIndex !== null && editingIndex >= 0 && editingIndex < state.notes.length) {
        state.notes[editingIndex] = note;
      } else {
        state.notes.unshift(note);
      }

      saveState();
      closeNoteModal();
      renderNotes();
    }

    // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø­Ù„ÙŠ
    function showLogin() {
      $("#login-overlay").classList.remove("hidden");
    }

    function hideLogin() {
      $("#login-overlay").classList.add("hidden");
    }

    function handleLoginSubmit(e) {
      e.preventDefault();
      const name = $("#login-name").value.trim() || "Ø¶ÙŠÙ";
      const email = $("#login-email").value.trim() || "guest@example.com";
      currentUser = { name, email };
      saveUserToStorage();
      loadState();
      hideLogin();
    }

    function handleLogout() {
      const yes = confirm("ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ØŸ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ø³ØªØ¨Ù‚Ù‰ Ù…Ø­ÙÙˆØ¸Ø© Ø¹Ù„Ù‰ Ù‡Ø°Ø§ Ø§Ù„Ø¬Ù‡Ø§Ø²ØŒ ÙˆÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø±Ø¬ÙˆØ¹ Ù„Ù‡Ø§ Ù„Ø§Ø­Ù‚Ø§Ù‹.");
      if (!yes) return;
      currentUser = null;
      saveUserToStorage();
      showLogin();
    }

    function initEvents() {
      // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
      $("#login-form").addEventListener("submit", handleLoginSubmit);
      $("#logout-btn").addEventListener("click", handleLogout);

      // Ø§Ù„Ø«ÙŠÙ…
      $("#theme-select").addEventListener("change", (e) => {
        state.theme = e.target.value;
        applyTheme(state.theme);
        saveState();
      });

      // Ù…Ø§Ø¡
      $("#water-plus").addEventListener("click", () => {
        state.trackers.water = Math.min(state.trackers.waterGoal, (state.trackers.water || 0) + 1);
        saveState();
        renderTrackers();
      });

      $("#water-minus").addEventListener("click", () => {
        state.trackers.water = Math.max(0, (state.trackers.water || 0) - 1);
        saveState();
        renderTrackers();
      });

      // Ù†ÙˆÙ…
      $("#sleep-hours").addEventListener("change", (e) => {
        state.trackers.sleepHours = parseFloat(e.target.value) || 0;
        saveState();
        renderTrackers();
      });

      // ØµÙ„Ø§Ø©
      $$("input[data-prayer]").forEach((cb) => {
        cb.addEventListener("change", (e) => {
          const key = e.target.getAttribute("data-prayer");
          state.trackers.prayers[key] = e.target.checked;
          saveState();
          renderTrackers();
        });
      });

      // Ø¬ÙŠÙ…
      $("#gym-done").addEventListener("change", (e) => {
        state.trackers.gymDone = e.target.checked;
        saveState();
        renderTrackers();
      });

      // Ù†ÙˆØªØ§Øª
      $("#new-note-btn").addEventListener("click", () => openNoteModal(null));
      $("#note-cancel-btn").addEventListener("click", (e) => {
        e.preventDefault();
        closeNoteModal();
      });
      $("#note-save-btn").addEventListener("click", (e) => {
        e.preventDefault();
        saveNoteFromModal();
      });

      $("#notes-grid").addEventListener("click", (e) => {
        const editIndex = e.target.getAttribute("data-edit");
        const deleteIndex = e.target.getAttribute("data-delete");
        if (editIndex !== null && editIndex !== undefined) {
          openNoteModal(parseInt(editIndex, 10));
        } else if (deleteIndex !== null && deleteIndex !== undefined) {
          const idx = parseInt(deleteIndex, 10);
          const ok = confirm("Ù…ØªØ£ÙƒØ¯ Ø£Ù†Ùƒ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø©ØŸ");
          if (ok) {
            state.notes.splice(idx, 1);
            saveState();
            renderNotes();
          }
        }
      });
    }

    window.addEventListener("DOMContentLoaded", () => {
      loadUserFromStorage();
      initEvents();
      if (currentUser) {
        loadState();
        hideLogin();
      } else {
        applyTheme("dark");
        showLogin();
      }
    });
  </script>
</body>
</html>
