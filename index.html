<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ATLAS Workspace â€“ Ù…Ø­Ù…ÙˆØ¯ Ø§Ù„ØµÙ…Ø§Ø¯ÙŠ</title>

  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link
    href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700&display=swap"
    rel="stylesheet"
  />

  <style>
    :root {
      --radius-lg: 18px;
      --radius-xl: 24px;
      --shadow-soft: 0 18px 45px rgba(0, 0, 0, 0.35);
      --shadow-card: 0 12px 25px rgba(0, 0, 0, 0.28);
      --transition-fast: 0.18s ease-out;
      --transition-med: 0.25s ease-out;

      --primary: #27b0ff;
      --primary-soft: rgba(39, 176, 255, 0.13);
      --danger: #ff5c7a;
      --success: #46d19b;
      --text-main: #eaf6ff;
      --text-soft: #a6b5d2;

      --bg-main: #020717;
      --bg-elevated: #060b22;
      --bg-deep: radial-gradient(circle at top left, #132347 0, #020717 55%);
      --card-bg: #050a1b;
      --border-subtle: rgba(255, 255, 255, 0.05);
    }

    body[data-theme="light"] {
      --bg-main: #f4f6fb;
      --bg-elevated: #ffffff;
      --bg-deep: radial-gradient(circle at top left, #ffffff 0, #e9f0ff 60%);
      --card-bg: #ffffff;
      --text-main: #0e172a;
      --text-soft: #4b5563;
      --border-subtle: rgba(15, 23, 42, 0.06);
      --shadow-soft: 0 16px 35px rgba(15, 23, 42, 0.1);
      --shadow-card: 0 12px 22px rgba(15, 23, 42, 0.08);
    }

    body[data-theme="oled"] {
      --bg-main: #000;
      --bg-elevated: #02040b;
      --bg-deep: radial-gradient(circle at top left, #071325 0, #000 60%);
      --card-bg: #02040b;
      --border-subtle: rgba(255, 255, 255, 0.08);
      --shadow-soft: none;
      --shadow-card: none;
    }

    * { box-sizing: border-box; }
    body {
      margin: 0;
      min-height: 100vh;
      font-family: "Cairo", system-ui, sans-serif;
      background: var(--bg-deep);
      color: var(--text-main);
      display: flex;
      justify-content: center;
    }

    .app-shell {
      width: 100%;
      max-width: 1400px;
      margin: 14px auto 24px;
      padding: 14px 14px 18px;
      background: linear-gradient(135deg, rgba(255,255,255,0.02), rgba(15,23,42,0.7));
      border-radius: 28px;
      border: 1px solid rgba(255,255,255,0.06);
      box-shadow: var(--shadow-soft);
      backdrop-filter: blur(16px);
      overflow: hidden;
    }

    header.app-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 12px;
      margin-bottom: 10px;
      flex-wrap: wrap;
    }

    .brand {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .brand-logo {
      width: 40px; height: 40px;
      border-radius: 14px;
      background: radial-gradient(circle at 25% 0, #4adeff 0, #2563eb 40%, #020617 80%);
      display: grid; place-items: center;
      font-weight: 800; font-size: 20px;
      box-shadow: 0 10px 22px rgba(37,99,235,0.6);
    }
    .brand-title { font-size: 18px; font-weight: 700; }
    .brand-subtitle { font-size: 11px; color: var(--text-soft); }

    .user-controls { display: flex; align-items: center; gap: 8px; flex-wrap: wrap; }
    .theme-switcher {
      display: inline-flex; padding: 3px; gap: 3px;
      border-radius: 999px; background: rgba(15,23,42,0.75);
      border: 1px solid var(--border-subtle);
    }
    .theme-pill {
      border: none; padding: 4px 9px; border-radius: 999px;
      font-size: 11px; background: transparent; color: var(--text-soft);
      cursor: pointer; transition: var(--transition-fast);
    }
    .theme-pill.active {
      background: var(--primary-soft); color: var(--text-main);
      transform: translateY(-1px);
    }

    .btn {
      border-radius: 999px; border: none;
      padding: 7px 12px; font-size: 12px; font-weight: 700;
      cursor: pointer; display: inline-flex; align-items: center; gap: 6px;
      transition: var(--transition-fast);
    }
    .btn-primary {
      background: var(--primary); color: #020617;
      box-shadow: 0 8px 18px rgba(37,99,235,0.7);
    }
    .btn-outline {
      background: transparent; color: var(--text-soft);
      border: 1px solid var(--border-subtle);
    }
    .btn-small { padding: 5px 9px; font-size: 11px; }

    /* Tabs */
    .tabs {
      display: flex; gap: 6px; flex-wrap: wrap;
      background: rgba(15,23,42,0.6);
      padding: 6px; border-radius: 14px;
      border: 1px solid var(--border-subtle);
      margin-bottom: 12px;
    }
    .tab-btn {
      flex: 1 1 auto;
      min-width: 120px;
      padding: 7px 10px;
      border-radius: 12px;
      border: 1px solid transparent;
      background: transparent;
      color: var(--text-soft);
      font-size: 12px;
      font-weight: 700;
      cursor: pointer;
      transition: var(--transition-fast);
      text-align: center;
    }
    .tab-btn.active {
      color: var(--text-main);
      background: var(--primary-soft);
      border-color: rgba(39,176,255,0.38);
    }

    .section { display: none; }
    .section.active { display: block; }

    /* Cards & layout */
    .grid-3 {
      display: grid; gap: 12px;
      grid-template-columns: repeat(3, minmax(0,1fr));
      align-items: start;
    }
    .column { display: flex; flex-direction: column; gap: 12px; }

    .card {
      background: var(--card-bg);
      border-radius: var(--radius-lg);
      border: 1px solid var(--border-subtle);
      box-shadow: var(--shadow-card);
      padding: 12px 14px;
    }
    .card-header { display: flex; justify-content: space-between; align-items: baseline; gap: 8px; margin-bottom: 6px; }
    .card-title { font-size: 14px; font-weight: 800; }
    .card-subtitle { font-size: 11px; color: var(--text-soft); }

    .stats-row { display: flex; gap: 8px; flex-wrap: wrap; }
    .stat-chip {
      flex: 1 1 120px;
      background: radial-gradient(circle at top left, rgba(56,189,248,0.18), transparent 60%);
      border-radius: 14px; padding: 8px;
      border: 1px solid var(--border-subtle);
    }
    .stat-label { font-size: 11px; color: var(--text-soft); display: flex; justify-content: space-between; }
    .stat-value { font-size: 15px; font-weight: 800; margin-top: 2px; }
    .stat-controls { display: flex; gap: 4px; margin-top: 6px; }
    .stat-controls button {
      flex: 1; border-radius: 999px; border: 1px solid rgba(148,163,184,0.3);
      background: rgba(15,23,42,0.8); color: var(--text-soft);
      font-size: 11px; padding: 3px 0; cursor: pointer;
      transition: var(--transition-fast);
    }
    .stat-controls button:hover { background: var(--primary-soft); color: var(--text-main); }

    .chip-row { display: flex; gap: 6px; flex-wrap: wrap; }
    .chip {
      border-radius: 999px; border: 1px solid var(--border-subtle);
      padding: 4px 9px; font-size: 11px;
      background: rgba(15,23,42,0.8); color: var(--text-soft);
      cursor: pointer; transition: var(--transition-fast);
    }
    .chip.active { background: var(--primary-soft); color: var(--text-main); transform: translateY(-1px); }

    .excuse-box {
      margin-top: 6px; padding: 10px 12px; border-radius: 14px;
      background: linear-gradient(135deg, rgba(15,23,42,0.9), rgba(30,64,175,0.9));
      border: 1px solid rgba(129,140,248,0.45);
    }

    .trust-bar { height: 6px; border-radius: 999px; background: rgba(15,23,42,0.7); overflow: hidden; margin-top: 4px; }
    .trust-fill { height: 100%; background: linear-gradient(90deg,#f97316,#facc15,#22c55e); width:70%; transition: width .35s; }

    /* Notes */
    .note-form {
      padding: 8px; border-radius: 14px;
      border: 1px dashed rgba(148,163,184,0.6);
      background: rgba(15,23,42,0.5);
      display: flex; flex-direction: column; gap: 6px;
    }
    .note-toolbar { display: flex; align-items: center; gap: 6px; flex-wrap: wrap; }
    .note-form input, .note-form textarea, .note-form select {
      border-radius: 10px; border: 1px solid rgba(148,163,184,0.35);
      background: rgba(15,23,42,0.7); color: var(--text-main);
      padding: 6px 8px; font-size: 12px; outline: none;
    }
    .notes-list { display: flex; flex-direction: column; gap: 8px; max-height: 320px; overflow: auto; padding-right: 3px; }
    .note-card {
      border-radius: 14px; padding: 8px 10px; border: 1px solid rgba(148,163,184,0.25);
      background: radial-gradient(circle at top left, rgba(51,65,85,0.4), transparent 55%);
    }
    .note-title { font-size: 13px; font-weight: 700; }
    .note-meta { font-size: 10px; color: var(--text-soft); }
    .note-body { font-size: 12px; line-height: 1.7; white-space: pre-wrap; margin-top: 2px; }
    .note-image {
      margin-top: 6px; border-radius: 10px; max-height: 160px; object-fit: cover; width: 100%;
      border: 1px solid rgba(148,163,184,0.35);
    }

    /* PDF Tools */
    .pdf-grid {
      display: grid; gap: 10px;
      grid-template-columns: repeat(4, minmax(0,1fr));
    }
    .pdf-tile {
      display: flex; flex-direction: column; gap: 6px;
      padding: 12px; border-radius: 14px;
      border: 1px solid var(--border-subtle);
      background: rgba(15,23,42,0.6);
      text-decoration: none; color: var(--text-main);
      transition: var(--transition-fast);
      min-height: 110px;
      justify-content: center;
    }
    .pdf-tile:hover {
      transform: translateY(-2px);
      border-color: rgba(39,176,255,0.5);
      background: var(--primary-soft);
    }
    .pdf-icon { font-size: 20px; }
    .pdf-title { font-size: 13px; font-weight: 800; }
    .pdf-sub { font-size: 11px; color: var(--text-soft); }

    footer {
      margin-top: 12px; font-size: 11px; color: var(--text-soft);
      display: flex; justify-content: space-between; gap: 6px; flex-wrap: wrap;
    }

    @media (max-width: 1100px) {
      .grid-3 { grid-template-columns: 1fr; }
      .pdf-grid { grid-template-columns: repeat(2, minmax(0,1fr)); }
    }
    @media (max-width: 650px) {
      .pdf-grid { grid-template-columns: 1fr; }
      .tab-btn { min-width: 90px; }
    }

    /* Modal for Login */
    .modal-backdrop{
      position: fixed; inset: 0;
      background: rgba(0,0,0,0.55);
      display: none; place-items: center;
      z-index: 50;
    }
    .modal{
      width: 100%; max-width: 420px;
      background: rgba(15,23,42,0.98);
      border: 1px solid rgba(148,163,184,0.45);
      border-radius: 18px; padding: 16px;
      box-shadow: 0 22px 70px rgba(0,0,0,0.8);
    }
    .modal h3{ margin:0 0 6px; font-size:18px; }
    .modal p{ margin:0 0 10px; font-size:12px; color:var(--text-soft); }
  </style>

  <!-- Firebase v8 -->
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
</head>

<body data-theme="dark">
  <div class="app-shell">

    <header class="app-header">
      <div class="brand">
        <div class="brand-logo">A</div>
        <div>
          <div class="brand-title">ATLAS Workspace</div>
          <div class="brand-subtitle">ØµÙÙ†Ø¹ Ø¨ÙˆØ§Ø³Ø·Ø© Ù…Ø­Ù…ÙˆØ¯ Ø§Ù„ØµÙ…Ø§Ø¯ÙŠ â€“ Ù…ÙˆÙ‚Ø¹ Ø´Ø§Ù…Ù„ Ù„Ù„Ø±ÙˆØªÙŠÙ† Ø§Ù„ÙŠÙˆÙ…ÙŠ</div>
        </div>
      </div>

      <div class="user-controls">
        <div class="theme-switcher">
          <button class="theme-pill active" data-theme="dark">Ø¯Ø§ÙƒÙ†</button>
          <button class="theme-pill" data-theme="oled">OLED</button>
          <button class="theme-pill" data-theme="light">ÙØ§ØªØ­</button>
        </div>

        <button class="btn btn-outline btn-small" id="loginBtn">ğŸ” ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Google</button>
        <button class="btn btn-outline btn-small" id="logoutBtn" style="display:none;">ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</button>

        <div class="btn btn-outline btn-small" id="userChip" style="cursor:default;">
          <span id="userNameLabel">Ø²Ø§Ø¦Ø±</span>
        </div>
      </div>
    </header>

    <!-- Tabs -->
    <div class="tabs">
      <button class="tab-btn active" data-tab="home">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
      <button class="tab-btn" data-tab="excuses">Ø§Ù„Ø£Ø¹Ø°Ø§Ø±</button>
      <button class="tab-btn" data-tab="notes">Ø§Ù„Ù†ÙˆØªØ§Øª</button>
      <button class="tab-btn" data-tab="pdf">Ø£Ø¯ÙˆØ§Øª PDF</button>
    </div>

    <!-- SECTION: HOME -->
    <section class="section active" id="home">
      <div class="grid-3">

        <div class="column">
          <div class="card">
            <div class="card-header">
              <div>
                <div class="card-title">Ø±ÙˆØªÙŠÙ† Ø§Ù„ÙŠÙˆÙ… ğŸ‘‹</div>
                <div class="card-subtitle">Ø¹Ø¯Ø§Ø¯Ø§Øª ÙŠÙˆÙ…ÙŠØ© Ù…Ø­ÙÙˆØ¸Ø©</div>
              </div>
            </div>

            <div id="greetingMain" style="font-size:17px;font-weight:800;">Ù…Ø±Ø­Ø¨Ø§Ù‹ ğŸ‘‹</div>
            <div id="greetingSecondary" class="card-subtitle" style="margin-top:2px;">
              Ø®Ù„ÙŠÙ†Ø§ Ù†Ø±ØªÙ‘Ø¨ ÙŠÙˆÙ…Ùƒ.
            </div>

            <div class="stats-row" style="margin-top:10px;">
              <div class="stat-chip" data-counter="water">
                <div class="stat-label"><span>Ø§Ù„Ù…ÙŠØ§Ù‡ ğŸ’§</span><span>Ù‡Ø¯ÙÙƒ 8</span></div>
                <div class="stat-value" id="waterValue">0 Ø£ÙƒÙˆØ§Ø¨</div>
                <div class="stat-controls">
                  <button data-action="dec">-</button>
                  <button data-action="inc">+1</button>
                </div>
              </div>

              <div class="stat-chip" data-counter="sleep">
                <div class="stat-label"><span>Ø§Ù„Ù†ÙˆÙ… ğŸ˜´</span><span>Ù‡Ø¯ÙÙƒ 8</span></div>
                <div class="stat-value" id="sleepValue">0 Ø³Ø§Ø¹Ø©</div>
                <div class="stat-controls">
                  <button data-action="dec">-</button>
                  <button data-action="inc">+0.5</button>
                </div>
              </div>
            </div>

            <div class="stats-row" style="margin-top:8px;">
              <div class="stat-chip" data-counter="prayer">
                <div class="stat-label"><span>Ø§Ù„ØµÙ„Ø§Ø© ğŸ•Œ</span><span>5</span></div>
                <div class="stat-value" id="prayerValue">0 / 5</div>
                <div class="stat-controls">
                  <button data-action="dec">-</button>
                  <button data-action="inc">+1</button>
                </div>
              </div>

              <div class="stat-chip" data-counter="gym">
                <div class="stat-label"><span>Ø§Ù„Ø¬ÙŠÙ… ğŸ‹ï¸â€â™‚ï¸</span><span>Ø£ÙŠØ§Ù…</span></div>
                <div class="stat-value" id="gymValue">0 Ø­ØµØ©</div>
                <div class="stat-controls">
                  <button data-action="dec">-</button>
                  <button data-action="inc">+1</button>
                </div>
              </div>
            </div>
          </div>

          <div class="card">
            <div class="card-header">
              <div>
                <div class="card-title">Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ù…Ø²Ø§Ø¬ ğŸ§</div>
                <div class="card-subtitle">Ø§Ø®ØªÙŠØ§Ø± Ø´Ø¹ÙˆØ±Ùƒ Ø§Ù„ÙŠÙˆÙ…</div>
              </div>
            </div>
            <div class="chip-row" id="moodChips">
              <button class="chip active" data-mood="focus">Ù…Ø±ÙƒÙ‘Ø²</button>
              <button class="chip" data-mood="tired">Ù…Ø±Ù‡Ù‚</button>
              <button class="chip" data-mood="social">Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠ</button>
              <button class="chip" data-mood="lazy">ÙƒØ³Ù„Ø§Ù†</button>
            </div>
          </div>
        </div>

        <div class="column">
          <div class="card">
            <div class="card-header">
              <div>
                <div class="card-title">Ù…ÙÙ„Ø®Ù‘Øµ Ø§Ù„Ù…ÙˆÙ‚Ø¹</div>
                <div class="card-subtitle">ÙƒÙ„ Ø§Ù„Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ù…Ù‡Ù…Ø© Ø¨Ù…ÙƒØ§Ù† ÙˆØ§Ø­Ø¯</div>
              </div>
            </div>

            <ul style="margin:6px 0 0; padding-right:16px; font-size:13px; line-height:1.9;">
              <li>Ù…ÙˆÙ„Ø¯ Ø£Ø¹Ø°Ø§Ø± Ø°ÙƒÙŠ Ù„Ù„ÙˆØ§ØªØ³Ø§Ø¨ ÙˆØ§Ù„Ø´ØºÙ„ ÙˆØ§Ù„Ø¯Ø±Ø§Ø³Ø©.</li>
              <li>Ù†ÙˆØªØ§Øª Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„ØªØ®ØµÙŠØµ (Ø¹Ù†ÙˆØ§Ù† + Ù„ÙˆÙ† + ØµÙˆØ±Ø©).</li>
              <li>Ø¹Ø¯Ø§Ø¯Ø§Øª ÙŠÙˆÙ…ÙŠØ© Ù„Ù„Ù…ÙŠØ§Ù‡ ÙˆØ§Ù„Ù†ÙˆÙ… ÙˆØ§Ù„ØµÙ„Ø§Ø© ÙˆØ§Ù„Ø¬ÙŠÙ….</li>
              <li>Ù‚Ø³Ù… Ø£Ø¯ÙˆØ§Øª PDF ÙƒØ§Ù…Ù„ Ø²ÙŠ iLovePDF.</li>
              <li>ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Google Ø§Ø®ØªÙŠØ§Ø±ÙŠ Ù„Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ø³Ø­Ø§Ø¨ÙŠØ§Ù‹.</li>
            </ul>
          </div>
        </div>

        <div class="column">
          <div class="card">
            <div class="card-header">
              <div>
                <div class="card-title">Ù†ØµÙŠØ­Ø© ATLAS âœ¨</div>
                <div class="card-subtitle">Ø´ÙŠØ¡ Ø¨Ø³ÙŠØ· ÙŠÙˆÙ…ÙŠÙ‹Ø§</div>
              </div>
            </div>
            <div style="font-size:13px; line-height:1.8;">
              Ø¬Ø±Ù‘Ø¨ ØªÙƒØªØ¨ Ù†ÙˆØªØ© ÙˆØ§Ø­Ø¯Ø© Ø¨Ø§Ù„ÙŠÙˆÙ…â€¦ Ø­ØªÙ‰ Ù„Ùˆ Ø³Ø·Ø±ÙŠÙ†. Ø¨Ø¹Ø¯ Ø´Ù‡Ø± Ø±Ø§Ø­ ØªØ´ÙˆÙ ÙƒÙŠÙ Ø¹Ù‚Ù„Ùƒ ØµØ§Ø± Ø£Ù†Ø¸Ù ÙˆØ±ÙˆØªÙŠÙ†Ùƒ Ø£Ù‡Ø¯Ù‰.
            </div>
          </div>
        </div>

      </div>
    </section>

    <!-- SECTION: EXCUSES -->
    <section class="section" id="excuses">
      <div class="grid-3">
        <div class="column" style="grid-column: span 2;">
          <div class="card">
            <div class="card-header">
              <div>
                <div class="card-title">Ù…ÙˆÙ„Ù‘Ø¯ Ø§Ù„Ø£Ø¹Ø°Ø§Ø± ATLAS ØºÙØ°ÙÙ‘Ø±Ù†ÙŠ ğŸ«£</div>
                <div class="card-subtitle">Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„Ù…ÙˆÙ‚Ù ÙˆØ§Ù„Ù…Ø²Ø§Ø¬ Ø«Ù… Ø§Ø¶ØºØ· Ø§Ø¹Ø°Ø±Ù†ÙŠ</div>
              </div>
            </div>

            <div style="margin-top:6px;">
              <div class="card-subtitle">Ù†ÙˆØ¹ Ø§Ù„Ù…ÙˆÙ‚Ù:</div>
              <div class="chip-row" id="contextChips" style="margin-top:4px;">
                <button class="chip active" data-context="whatsapp">ÙˆØ§ØªØ³Ø§Ø¨ / Ø£ÙˆÙ†Ù„Ø§ÙŠÙ†</button>
                <button class="chip" data-context="family">Ø£Ù‡Ù„ / Ø¹Ø§Ø¦Ù„Ø©</button>
                <button class="chip" data-context="work">Ø´ØºÙ„</button>
                <button class="chip" data-context="study">Ø¯Ø±Ø§Ø³Ø©</button>
                <button class="chip" data-context="delay">ØªØ£Ø®ÙŠØ± Ù…ÙˆØ¹Ø¯</button>
              </div>
            </div>

            <div style="margin-top:10px;">
              <div class="card-subtitle">Ù…Ø²Ø§Ø¬ Ø§Ù„Ø¹Ø°Ø±:</div>
              <div class="chip-row" id="toneChips" style="margin-top:4px;">
                <button class="chip active" data-tone="soft">Ù„Ø·ÙŠÙ</button>
                <button class="chip" data-tone="serious">Ø±Ø³Ù…ÙŠ</button>
                <button class="chip" data-tone="funny">Ù…Ø²Ø­</button>
              </div>
            </div>

            <div style="display:flex;justify-content:flex-end;margin-top:8px;">
              <button class="btn btn-primary btn-small" id="generateExcuseBtn">ğŸ² Ø§Ø¹Ø°Ø±Ù†ÙŠ</button>
            </div>

            <div class="excuse-box">
              <div style="font-size:11px;color:var(--text-soft);">Ø§Ù„Ø¹Ø°Ø± Ø§Ù„Ø­Ø§Ù„ÙŠ:</div>
              <div id="excuseText" style="font-size:14px;line-height:1.7;margin-top:2px;">
                ÙƒÙ†Øª Ø­Ø§Ø· Ø§Ù„Ø¬ÙˆØ§Ù„ Ø¹Ù„Ù‰ Ø§Ù„ØµØ§Ù…Øª ÙˆÙ…Ø§ Ø§Ù†ØªØ¨Ù‡Øª Ù„Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§ØªØŒ Ø£ÙˆÙ„ Ù…Ø§ Ø´ÙØª Ø±Ø³Ø§Ù„ØªÙƒ Ø±Ø¬Ø¹ØªÙ„Ùƒ.
              </div>

              <div style="margin-top:8px;font-size:11px;color:var(--text-soft);">
                Ø§Ø­ØªÙ…Ø§Ù„ ÙŠØµØ¯Ù‚ÙˆÙƒ ğŸ‘‡
                <div class="trust-bar"><div class="trust-fill" id="trustFill"></div></div>
                <div id="trustLabel" style="margin-top:4px;">
                  ØªÙ‚Ø¯ÙŠØ±ÙŠÙ‹Ø§: 79% â€“ ÙŠØ¹ØªÙ…Ø¯ Ø¹Ù„Ù‰ Ù…Ø²Ø§Ø¬ Ø§Ù„Ø´Ø®Øµ Ø§Ù„Ù…Ù‚Ø§Ø¨Ù„ ğŸ˜…
                </div>
              </div>

              <div style="margin-top:8px;display:flex;justify-content:space-between;align-items:center;gap:6px;">
                <small style="color:var(--text-soft);font-size:10px;">
                  Ù„Ù„ØªØ±ÙÙŠÙ‡ ÙÙ‚Ø·.
                </small>
                <button class="btn btn-outline btn-small" id="copyExcuseBtn">ğŸ“‹ Ù†Ø³Ø®</button>
              </div>
            </div>
          </div>
        </div>

        <div class="column">
          <div class="card">
            <div class="card-header">
              <div>
                <div class="card-title">ÙƒÙŠÙ ØªØ³ØªØ¹Ù…Ù„Ù‡ØŸ</div>
                <div class="card-subtitle">Ù£ Ø®Ø·ÙˆØ§Øª</div>
              </div>
            </div>
            <ol style="margin:0; padding-right:18px; font-size:12px; line-height:1.8;">
              <li>Ø§Ø®ØªØ± Ø§Ù„Ù…ÙˆÙ‚Ù.</li>
              <li>Ø§Ø®ØªØ± Ù…Ø²Ø§Ø¬ Ø§Ù„Ø¹Ø°Ø±.</li>
              <li>Ø§Ø¶ØºØ· Ø§Ø¹Ø°Ø±Ù†ÙŠ Ùˆ Ø§Ù†Ø³Ø®.</li>
            </ol>
          </div>
        </div>
      </div>
    </section>

    <!-- SECTION: NOTES -->
    <section class="section" id="notes">
      <div class="grid-3">
        <div class="column" style="grid-column: span 2;">
          <div class="card">
            <div class="card-header">
              <div>
                <div class="card-title">Ù†ÙˆØªØ§ØªÙƒ Ø§Ù„ÙŠÙˆÙ…ÙŠØ© ğŸ“</div>
                <div class="card-subtitle">Ù„Ù„Ø²Ø§Ø¦Ø±: ØªÙØ­ÙØ¸ Ù…Ø­Ù„ÙŠØ§Ù‹. Ù„Ù„Ù…Ø³Ø¬Ù‘Ù„: ØªÙØ²Ø§Ù…Ù† Ù…Ø¹ Ø­Ø³Ø§Ø¨Ù‡.</div>
              </div>
            </div>

            <form class="note-form" id="noteForm">
              <div class="note-toolbar">
                <span style="font-size:11px;color:var(--text-soft);">Ù†ÙˆØªØ© Ø¬Ø¯ÙŠØ¯Ø©:</span>
                <input type="color" id="noteColor" value="#1d4ed8" title="Ù„ÙˆÙ† Ø§Ù„Ù†ÙˆØªØ©" />
                <select id="noteFontSize">
                  <option value="13">Ø®Ø· Ø¹Ø§Ø¯ÙŠ</option>
                  <option value="15">Ù…ØªÙˆØ³Ø·</option>
                  <option value="17">ÙƒØ¨ÙŠØ±</option>
                </select>
              </div>

              <div style="display:flex;gap:6px;flex-wrap:wrap;">
                <input id="noteTitle" type="text" placeholder="Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù†ÙˆØªØ©" required style="flex:1;min-width:180px;" />
                <input id="noteImageUrl" type="text" placeholder="Ø±Ø§Ø¨Ø· ØµÙˆØ±Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)" style="flex:1;min-width:180px;" />
              </div>

              <textarea id="noteContent" rows="3" placeholder="Ø§ÙƒØªØ¨ Ù†ÙˆØªØªÙƒâ€¦" required></textarea>

              <div style="display:flex;justify-content:flex-end;">
                <button type="submit" class="btn btn-primary btn-small">+ Ø­ÙØ¸</button>
              </div>
            </form>

            <div class="notes-list" id="notesList"></div>
          </div>
        </div>

        <div class="column">
          <div class="card">
            <div class="card-header">
              <div>
                <div class="card-title">Ù…Ø¹Ù„ÙˆÙ…Ø© Ø³Ø±ÙŠØ¹Ø©</div>
                <div class="card-subtitle">Ù„ÙŠØ´ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù…ÙÙŠØ¯ØŸ</div>
              </div>
            </div>
            <div style="font-size:12px;line-height:1.8;">
              Ø¥Ø°Ø§ Ø³Ø¬Ù„Øª GoogleØŒ Ù†ÙˆØªØ§ØªÙƒ ÙˆØ¹Ø¯Ø§Ø¯Ø§ØªÙƒ Ø¨ØªÙ†Ø­ÙØ¸ Ø¨Ø§Ù„Ø³Ø­Ø§Ø¨Ø© ÙˆØ¨ØªØ±Ø¬Ø¹Ù„Ùƒ Ù…Ù† Ø£ÙŠ Ø¬Ù‡Ø§Ø².
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- SECTION: PDF -->
    <section class="section" id="pdf">
      <div class="card" style="margin-bottom:10px;">
        <div class="card-header">
          <div>
            <div class="card-title">Ø£Ø¯ÙˆØ§Øª PDF â€“ Ø¯Ø§Ø®Ù„ ATLAS</div>
            <div class="card-subtitle">ÙƒÙ„ Ø§Ù„ØªØ­ÙˆÙŠÙ„Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© Ù…Ø«Ù„ iLovePDF (ØªÙØªØ­ Ø£Ø¯ÙˆØ§Øª Ø®Ø§Ø±Ø¬ÙŠØ© Ù…ÙˆØ«ÙˆÙ‚Ø©)</div>
          </div>
        </div>
      </div>

      <div class="pdf-grid">
        <!-- Images / PDF -->
        <a class="pdf-tile" target="_blank" href="https://www.ilovepdf.com/jpg_to_pdf">
          <div class="pdf-icon">ğŸ–¼ï¸â¡ï¸ğŸ“„</div>
          <div class="pdf-title">ØµÙˆØ± Ø¥Ù„Ù‰ PDF</div>
          <div class="pdf-sub">JPG / PNG Ø¥Ù„Ù‰ PDF</div>
        </a>

        <a class="pdf-tile" target="_blank" href="https://www.ilovepdf.com/pdf_to_jpg">
          <div class="pdf-icon">ğŸ“„â¡ï¸ğŸ–¼ï¸</div>
          <div class="pdf-title">PDF Ø¥Ù„Ù‰ ØµÙˆØ±</div>
          <div class="pdf-sub">PDF Ø¥Ù„Ù‰ JPG / PNG</div>
        </a>

        <!-- Word / PDF -->
        <a class="pdf-tile" target="_blank" href="https://www.ilovepdf.com/word_to_pdf">
          <div class="pdf-icon">ğŸ“â¡ï¸ğŸ“„</div>
          <div class="pdf-title">Word Ø¥Ù„Ù‰ PDF</div>
          <div class="pdf-sub">DOC / DOCX Ø¥Ù„Ù‰ PDF</div>
        </a>

        <a class="pdf-tile" target="_blank" href="https://www.ilovepdf.com/pdf_to_word">
          <div class="pdf-icon">ğŸ“„â¡ï¸ğŸ“</div>
          <div class="pdf-title">PDF Ø¥Ù„Ù‰ Word</div>
          <div class="pdf-sub">PDF Ø¥Ù„Ù‰ DOCX</div>
        </a>

        <!-- PowerPoint / PDF -->
        <a class="pdf-tile" target="_blank" href="https://www.ilovepdf.com/powerpoint_to_pdf">
          <div class="pdf-icon">ğŸ“Šâ¡ï¸ğŸ“„</div>
          <div class="pdf-title">PowerPoint Ø¥Ù„Ù‰ PDF</div>
          <div class="pdf-sub">PPT / PPTX Ø¥Ù„Ù‰ PDF</div>
        </a>

        <a class="pdf-tile" target="_blank" href="https://www.ilovepdf.com/pdf_to_powerpoint">
          <div class="pdf-icon">ğŸ“„â¡ï¸ğŸ“Š</div>
          <div class="pdf-title">PDF Ø¥Ù„Ù‰ PowerPoint</div>
          <div class="pdf-sub">PDF Ø¥Ù„Ù‰ PPTX</div>
        </a>

        <!-- Excel / PDF -->
        <a class="pdf-tile" target="_blank" href="https://www.ilovepdf.com/excel_to_pdf">
          <div class="pdf-icon">ğŸ“ˆâ¡ï¸ğŸ“„</div>
          <div class="pdf-title">Excel Ø¥Ù„Ù‰ PDF</div>
          <div class="pdf-sub">XLS / XLSX Ø¥Ù„Ù‰ PDF</div>
        </a>

        <a class="pdf-tile" target="_blank" href="https://www.ilovepdf.com/pdf_to_excel">
          <div class="pdf-icon">ğŸ“„â¡ï¸ğŸ“ˆ</div>
          <div class="pdf-title">PDF Ø¥Ù„Ù‰ Excel</div>
          <div class="pdf-sub">PDF Ø¥Ù„Ù‰ XLSX</div>
        </a>

        <!-- Tools -->
        <a class="pdf-tile" target="_blank" href="https://www.ilovepdf.com/merge_pdf">
          <div class="pdf-icon">ğŸ§©</div>
          <div class="pdf-title">Ø¯Ù…Ø¬ Ù…Ù„ÙØ§Øª PDF</div>
          <div class="pdf-sub">Merge PDF</div>
        </a>

        <a class="pdf-tile" target="_blank" href="https://www.ilovepdf.com/split_pdf">
          <div class="pdf-icon">âœ‚ï¸</div>
          <div class="pdf-title">ØªÙ‚Ø³ÙŠÙ… PDF</div>
          <div class="pdf-sub">Split PDF</div>
        </a>

        <a class="pdf-tile" target="_blank" href="https://www.ilovepdf.com/compress_pdf">
          <div class="pdf-icon">ğŸ“‰</div>
          <div class="pdf-title">Ø¶ØºØ· PDF</div>
          <div class="pdf-sub">Compress PDF</div>
        </a>

        <a class="pdf-tile" target="_blank" href="https://www.ilovepdf.com/edit-pdf">
          <div class="pdf-icon">âœï¸</div>
          <div class="pdf-title">ØªØ¹Ø¯ÙŠÙ„ PDF</div>
          <div class="pdf-sub">Edit PDF</div>
        </a>
      </div>
    </section>

    <footer>
      <span>ATLAS Workspace Â© Ù…Ø­Ù…ÙˆØ¯ Ø§Ù„ØµÙ…Ø§Ø¯ÙŠ</span>
      <span>Ù…ÙˆÙ‚Ø¹ Ø´Ø§Ù…Ù„ Ù„Ù„Ø±ÙˆØªÙŠÙ† Ø§Ù„ÙŠÙˆÙ…ÙŠ + Ø£Ø¯ÙˆØ§Øª PDF + Ù†ÙˆØªØ§Øª + Ø£Ø¹Ø°Ø§Ø±.</span>
    </footer>
  </div>

  <!-- LOGIN MODAL -->
  <div class="modal-backdrop" id="loginModal">
    <div class="modal">
      <h3>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</h3>
      <p>Ø¥Ø°Ø§ Ø³Ø¬Ù„Øª Ø¨Ø­Ø³Ø§Ø¨ GoogleØŒ Ø¨ØªÙ†Ø­ÙØ¸ ÙƒÙ„ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ø³Ø­Ø§Ø¨ÙŠØ§Ù‹ ÙˆØ¨ØªÙ‚Ø¯Ø± ØªØ±Ø¬Ø¹Ù‡Ø§ Ù…Ù† Ø£ÙŠ Ø¬Ù‡Ø§Ø².</p>
      <div style="display:flex;gap:6px;justify-content:flex-end;">
        <button class="btn btn-outline btn-small" id="closeLoginModal">Ø¥Ù„ØºØ§Ø¡</button>
        <button class="btn btn-primary btn-small" id="googleLoginBtn">ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Google</button>
      </div>
    </div>
  </div>

  <script>
    // ===== Firebase Config =====
    const firebaseConfig = {
      apiKey: "AIzaSyDTOtQbGaLpGtDc34GXzcdppCvEJ60TYSs",
      authDomain: "atlas-workspace.firebaseapp.com",
      projectId: "atlas-workspace",
      storageBucket: "atlas-workspace.firebasestorage.app",
      messagingSenderId: "95882710960",
      appId: "1:95882710960:web:9fcafcc1d4d057029ad075",
      measurementId: "G-KJ446WXXHG",
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    // ===== Tabs =====
    const tabBtns = document.querySelectorAll(".tab-btn");
    const sections = document.querySelectorAll(".section");
    tabBtns.forEach(b=>{
      b.addEventListener("click", ()=>{
        tabBtns.forEach(x=>x.classList.remove("active"));
        b.classList.add("active");
        sections.forEach(s=>s.classList.remove("active"));
        document.getElementById(b.dataset.tab).classList.add("active");
      });
    });

    // ===== Theme =====
    const themeButtons = document.querySelectorAll(".theme-pill");
    function applyTheme(theme) {
      document.body.setAttribute("data-theme", theme);
      localStorage.setItem("atlas_theme", theme);
      themeButtons.forEach(btn => btn.classList.toggle("active", btn.dataset.theme === theme));
      if(currentUser && userDocRef){
        userDocRef.set({ theme }, { merge:true }).catch(console.error);
      }
    }
    themeButtons.forEach(btn => btn.addEventListener("click", ()=>applyTheme(btn.dataset.theme)));
    applyTheme(localStorage.getItem("atlas_theme") || "dark");

    // ===== Login Modal =====
    const loginBtn = document.getElementById("loginBtn");
    const logoutBtn = document.getElementById("logoutBtn");
    const loginModal = document.getElementById("loginModal");
    const closeLoginModal = document.getElementById("closeLoginModal");
    const googleLoginBtn = document.getElementById("googleLoginBtn");

    loginBtn.addEventListener("click", ()=> loginModal.style.display="grid");
    closeLoginModal.addEventListener("click", ()=> loginModal.style.display="none");
    loginModal.addEventListener("click", (e)=> { if(e.target===loginModal) loginModal.style.display="none"; });

    googleLoginBtn.addEventListener("click", async ()=>{
      try{
        const provider = new firebase.auth.GoogleAuthProvider();
        await auth.signInWithPopup(provider);
        loginModal.style.display="none";
      }catch(err){
        alert("ØªØ¹Ø°Ø± ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„: " + err.message);
      }
    });
    logoutBtn.addEventListener("click", ()=> auth.signOut());

    // ===== User / Greeting =====
    const userNameLabel = document.getElementById("userNameLabel");
    const greetingMain = document.getElementById("greetingMain");
    const greetingSecondary = document.getElementById("greetingSecondary");

    let currentUser=null, userDocRef=null, notesUnsubscribe=null;

    function updateGreeting(name){
      const h=new Date().getHours();
      let g="Ù…Ø±Ø­Ø¨Ø§Ù‹", e="âœ¨";
      if(h>=5 && h<12){ g="ØµØ¨Ø§Ø­ Ø§Ù„Ø®ÙŠØ±"; e="ğŸŒ¤ï¸"; }
      else if(h>=12 && h<18){ g="Ù…Ø³Ø§Ø¡ Ø§Ù„Ø®ÙŠØ±"; e="ğŸŒ‡"; }
      else { g="Ù…Ø³Ø§Ø¡ Ø§Ù„Ù‡Ø¯ÙˆØ¡"; e="ğŸŒ™"; }
      greetingMain.textContent = `${g}ØŒ ${name} ${e}`;
      greetingSecondary.textContent = "Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø´ØºØ§Ù„ ÙƒØ²Ø§Ø¦Ø± Ø£Ùˆ Ø¨Ø­Ø³Ø§Ø¨ Google â€“ Ø§Ù„Ù„ÙŠ Ø¨Ø±ÙŠØ­Ùƒ.";
    }

    auth.onAuthStateChanged(async user=>{
      currentUser=user||null;
      if(!user){
        userNameLabel.textContent="Ø²Ø§Ø¦Ø±";
        loginBtn.style.display="inline-flex";
        logoutBtn.style.display="none";
        updateGreeting("Ø²Ø§Ø¦Ø±");
        loadGuestCounters();
        loadGuestNotes();
        if(notesUnsubscribe) notesUnsubscribe();
        return;
      }

      const name=(user.displayName||user.email||"Ù…Ø³ØªØ®Ø¯Ù…").split(" ")[0];
      userNameLabel.textContent=name;
      loginBtn.style.display="none";
      logoutBtn.style.display="inline-flex";
      updateGreeting(name);

      userDocRef=db.collection("users").doc(user.uid);
      const snap=await userDocRef.get();
      if(!snap.exists){
        await userDocRef.set({water:0,sleep:0,prayer:0,gym:0,theme:localStorage.getItem("atlas_theme")||"dark"});
      }else{
        const d=snap.data();
        updateCountersFromData(d);
        if(d.theme) applyTheme(d.theme);
      }
      subscribeToNotes();
    });

    // ===== Counters =====
    const counters={water:0,sleep:0,prayer:0,gym:0};

    function updateCounterUI(){
      waterValue.textContent = counters.water + (counters.water===1?" ÙƒÙˆØ¨":" Ø£ÙƒÙˆØ§Ø¨");
      sleepValue.textContent = counters.sleep + " Ø³Ø§Ø¹Ø©";
      prayerValue.textContent = `${counters.prayer} / 5`;
      gymValue.textContent = counters.gym + " Ø­ØµØ©";
    }
    function updateCountersFromData(d){
      counters.water=d.water??0;
      counters.sleep=d.sleep??0;
      counters.prayer=d.prayer??0;
      counters.gym=d.gym??0;
      updateCounterUI();
    }
    function saveGuestCounters(){
      localStorage.setItem("guest_counters", JSON.stringify(counters));
    }
    function loadGuestCounters(){
      const s=localStorage.getItem("guest_counters");
      if(!s) { updateCounterUI(); return; }
      try{ Object.assign(counters, JSON.parse(s)); }catch{}
      updateCounterUI();
    }
    async function persistCounters(){
      if(!currentUser||!userDocRef){ saveGuestCounters(); return; }
      await userDocRef.set(counters,{merge:true}).catch(console.error);
    }

    document.querySelectorAll(".stat-chip").forEach(chip=>{
      const type=chip.dataset.counter;
      chip.querySelectorAll(".stat-controls button").forEach(btn=>{
        btn.addEventListener("click", ()=>{
          const a=btn.dataset.action;
          if(type==="sleep"){
            counters.sleep += (a==="inc"?0.5:-0.5);
            if(counters.sleep<0) counters.sleep=0;
          }else if(type==="prayer"){
            counters.prayer += (a==="inc"?1:-1);
            if(counters.prayer<0) counters.prayer=0;
            if(counters.prayer>5) counters.prayer=5;
          }else{
            counters[type] += (a==="inc"?1:-1);
            if(counters[type]<0) counters[type]=0;
          }
          updateCounterUI();
          persistCounters();
        });
      });
    });

    // ===== Mood chips =====
    const moodChips=document.getElementById("moodChips");
    moodChips.addEventListener("click",(e)=>{
      if(!e.target.classList.contains("chip")) return;
      moodChips.querySelectorAll(".chip").forEach(c=>c.classList.remove("active"));
      e.target.classList.add("active");
    });

    function wireChipGroup(id){
      const c=document.getElementById(id);
      c.addEventListener("click",(e)=>{
        if(!e.target.classList.contains("chip")) return;
        c.querySelectorAll(".chip").forEach(x=>x.classList.remove("active"));
        e.target.classList.add("active");
      });
    }
    wireChipGroup("contextChips"); wireChipGroup("toneChips");

    // ===== Excuses =====
    const excusesDB={
      whatsapp:{
        soft:[
          "ÙƒÙ†Øª Ø­Ø§Ø· Ø§Ù„Ø¬ÙˆØ§Ù„ Ø¹Ù„Ù‰ Ø§Ù„ØµØ§Ù…Øª ÙˆÙ…Ø§ Ø§Ù†ØªØ¨Ù‡Øª Ù„Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§ØªØŒ Ø£ÙˆÙ„ Ù…Ø§ Ø´ÙØª Ø±Ø³Ø§Ù„ØªÙƒ Ø±Ø¬Ø¹ØªÙ„Ùƒ.",
          "Ø§Ù„Ù†Øª ÙƒØ§Ù† ÙŠÙØµÙ„ ÙˆÙŠØ±Ø¬Ø¹ ÙˆÙ…Ø§ ÙˆØµÙ„Ù†ÙŠ Ø¥Ø´Ø¹Ø§Ø±Ùƒ ØºÙŠØ± Ù…ØªØ£Ø®Ø±."
        ],
        serious:[
          "ÙƒÙ†Øª ÙÙŠ Ø§Ø¬ØªÙ…Ø§Ø¹ ÙˆÙ…Ø§ Ù‚Ø¯Ø±Øª Ø£Ù…Ø³Ùƒ Ø§Ù„Ø¬ÙˆØ§Ù„ Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ØŒ Ø£ÙˆÙ„ Ù…Ø§ Ø®Ù„ØµØª Ø±Ø¯ÙŠØª Ø¹Ù„ÙŠÙƒ.",
          "ÙƒÙ†Øª Ø®Ø§Ø±Ø¬ Ø§Ù„Ø¨ÙŠØª ÙˆØ§Ù†Ù‚Ø·Ø¹Øª Ø§Ù„Ø¨ÙŠØ§Ù†Ø§ØªØŒ Ø£ÙˆÙ„ Ù…Ø§ Ø±Ø¬Ø¹Øª Ù„Ù„ÙˆØ§ÙŠ ÙØ§ÙŠ Ø¯Ø®Ù„Øª ÙˆØ±Ø¯ÙŠØª."
        ],
        funny:[
          "Ø¯Ø®Ù„Øª Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨ Ø£Ù†Ø³Ù‰ Ù„ÙŠÙ‡ Ø¯Ø®Ù„Øª ÙˆØ·Ù„Ø¹Øª Ø¨Ø¯ÙˆÙ† Ù…Ø§ Ø£Ø±Ø¯â€¦ Ø¯Ù…Ø§ØºÙŠ Ø§Ù„ÙŠÙˆÙ… Ø·ÙŠØ±Ø§Ù† ğŸ˜….",
          "ÙƒÙ†Øª Ø¨Ù†Ø¸Ù‘Ù Ø¬Ù‡Ø§Øª Ø§Ù„Ø§ØªØµØ§Ù„ ÙˆØ·Ø§Ø± Ø¹Ù‚Ù„ÙŠ Ù…Ø¹Ø§Ù‡Ù… ğŸ¤¦â€â™‚ï¸."
        ]
      },
      family:{
        soft:["ÙƒÙ†Øª Ø¨Ø³Ø§Ø¹Ø¯ Ø¨Ø§Ù„Ø¨ÙŠØª ÙˆÙ…Ø§ Ø§Ù†ØªØ¨Ù‡Øª Ù„Ù„Ø¬ÙˆØ§Ù„.","ÙƒÙ†Øª Ù†Ø§ÙŠÙ… Ø¨Ø¯Ø±ÙŠ ÙˆÙ…Ø§ Ø³Ù…Ø¹Øª Ø§Ù„Ø±Ù†Ù‘Ø©."],
        serious:["ØµØ§Ø± Ø¸Ø±Ù Ø¶Ø±ÙˆØ±ÙŠ ÙˆÙ…Ø§ ÙƒØ§Ù† Ø¹Ù†Ø¯ÙŠ Ù…Ø¬Ø§Ù„ Ø£Ø±Ø¯ØŒ Ø£ÙˆÙ„ Ù…Ø§ Ø®Ù„ØµØª Ø±Ø¬Ø¹Øª Ø®Ø¨Ø±ØªÙƒÙ…."],
        funny:["Ø§Ù„Ø¬ÙˆØ§Ù„ Ø±Ù† ÙƒØ«ÙŠØ± ÙØ®ÙØª ÙŠÙƒÙˆÙ† ØªØ­ØµÙŠÙ„ ÙƒÙ‡Ø±Ø¨Ø§ ğŸ˜‚."]
      },
      work:{
        soft:["ÙƒÙ†Øª Ù…Ø±ÙƒØ² ÙÙŠ Ø´ØºÙ„ Ù…Ù‡Ù… ÙˆÙ…Ø§ ÙØªØ­Øª Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨ Ø¹Ø´Ø§Ù† Ù…Ø§ Ø£ØªØ´ØªØª."],
        serious:["ÙƒØ§Ù† Ø¹Ù†Ø¯ÙŠ Ø¶ØºØ· ÙˆØ§Ø¬ØªÙ…Ø§Ø¹Ø§Øª Ù…ØªØªØ§Ù„ÙŠØ©ØŒ ÙØ®Ù„Ù‘ØµØªÙ‡Ù… ÙˆØ¨Ø¹Ø¯Ù‡Ø§ Ø±Ø¯ÙŠØª."],
        funny:["ÙƒÙ†Øª Ø¨ÙƒØªØ¨ Ø¥ÙŠÙ…ÙŠÙ„ Ù…Ø­ØªØ±Ù… ÙˆÙ†Ø³Ø®ØªÙ‡ Ù‡ÙˆÙ† Ø¨Ø§Ù„ØºÙ„Ø· ğŸ˜…."]
      },
      study:{
        soft:["ÙƒÙ†Øª Ø¨Ø¯Ø±Ø³ ÙˆÙ…Ø³ÙƒØ± Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø¹Ø´Ø§Ù† Ø£Ø±ÙƒØ²."],
        serious:["ÙƒØ§Ù† Ø¹Ù†Ø¯ÙŠ Ù…Ø­Ø§Ø¶Ø±Ø©/Ø§Ù…ØªØ­Ø§Ù† ÙˆÙ…Ø§ ÙƒØ§Ù† Ù…Ø³Ù…ÙˆØ­ Ù†Ù…Ø³Ùƒ Ø§Ù„Ø¬ÙˆØ§Ù„."],
        funny:["Ø§Ù„ÙƒØªØ§Ø¨ Ù…ÙØªÙˆØ­ ÙˆØ§Ù„Ø¬ÙˆØ§Ù„ Ø¨Ø¹ÙŠØ¯â€¦ ÙˆØ§Ù„Ù†ØªÙŠØ¬Ø© Ù„Ø§ Ø¯Ø±Ø³Øª ÙˆÙ„Ø§ Ø±Ø¯ÙŠØª ğŸ˜…."]
      },
      delay:{
        soft:["Ø¹Ù„Ù‚Øª Ø¨Ø²Ø­Ù…Ø© Ø¨Ø³ÙŠØ·Ø©ØŒ Ø¨Ø³ Ù‡ÙŠÙ†ÙŠ Ø¬Ø§ÙŠ Ø¨Ø§Ù„Ø·Ø±ÙŠÙ‚."],
        serious:["ØµØ§Ø± Ø¸Ø±Ù Ø·Ø§Ø±Ø¦ Ø£Ø®Ù‘Ø±Ù†ÙŠ Ø´ÙˆÙŠØŒ Ø¨Ø³ Ø£Ù†Ø§ Ø¨Ø§Ù„Ø·Ø±ÙŠÙ‚."],
        funny:["Ø§Ù„Ø²Ù…Ù† Ø§Ù„ÙŠÙˆÙ… Ù…ØªØ¢Ù…Ø± Ø¹Ù„ÙŠÙ‘ ğŸ˜‚."]
      }
    };

    const excuseTextEl=document.getElementById("excuseText");
    const trustFill=document.getElementById("trustFill");
    const trustLabel=document.getElementById("trustLabel");

    function rand(arr){ return arr[Math.floor(Math.random()*arr.length)]; }

    document.getElementById("generateExcuseBtn").addEventListener("click", ()=>{
      const ctx=document.querySelector("#contextChips .chip.active")?.dataset.context||"whatsapp";
      const tone=document.querySelector("#toneChips .chip.active")?.dataset.tone||"soft";
      const pool=excusesDB[ctx]?.[tone]||excusesDB.whatsapp.soft;
      excuseTextEl.textContent=rand(pool);

      const t=Math.floor(65+Math.random()*30);
      trustFill.style.width=t+"%";
      trustLabel.textContent=`ØªÙ‚Ø¯ÙŠØ±ÙŠÙ‹Ø§: ${t}% â€“ ÙŠØ¹ØªÙ…Ø¯ Ø¹Ù„Ù‰ Ù…Ø²Ø§Ø¬ Ø§Ù„Ø´Ø®Øµ Ø§Ù„Ù…Ù‚Ø§Ø¨Ù„ ğŸ˜…`;
    });

    document.getElementById("copyExcuseBtn").addEventListener("click", async ()=>{
      try{
        await navigator.clipboard.writeText(excuseTextEl.textContent.trim());
        alert("ØªÙ… Ø§Ù„Ù†Ø³Ø® âœ…");
      }catch{
        alert("Ø§Ù†Ø³Ø®Ù‡ ÙŠØ¯ÙˆÙŠÙ‹Ø§ Ù„Ùˆ Ø³Ù…Ø­Øª.");
      }
    });

    // ===== Notes =====
    const notesListEl=document.getElementById("notesList");
    const noteForm=document.getElementById("noteForm");
    const noteTitleInput=document.getElementById("noteTitle");
    const noteImageUrlInput=document.getElementById("noteImageUrl");
    const noteContentInput=document.getElementById("noteContent");
    const noteColorInput=document.getElementById("noteColor");
    const noteFontSizeSelect=document.getElementById("noteFontSize");

    function renderNote(note){
      const div=document.createElement("div");
      div.className="note-card";
      if(note.color){
        div.style.borderColor=note.color;
        div.style.background=`linear-gradient(135deg, ${note.color}30, transparent 60%)`;
      }
      div.innerHTML=`
        <div style="display:flex;justify-content:space-between;align-items:center;">
          <div class="note-title">${note.title||"Ø¨Ø¯ÙˆÙ† Ø¹Ù†ÙˆØ§Ù†"}</div>
          <div class="note-meta">${note.createdAt||""}</div>
        </div>
        <div class="note-body" style="font-size:${note.fontSize||13}px;">${(note.content||"").replace(/\n/g,"<br>")}</div>
        ${note.imageUrl?`<img class="note-image" src="${note.imageUrl}" onerror="this.style.display='none'"/>`:""}
      `;
      notesListEl.appendChild(div);
    }

    function saveGuestNotes(notes){
      localStorage.setItem("guest_notes", JSON.stringify(notes));
    }
    function loadGuestNotes(){
      notesListEl.innerHTML="";
      const s=localStorage.getItem("guest_notes");
      if(!s){
        notesListEl.innerHTML='<div style="font-size:12px;color:var(--text-soft);">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ÙˆØªØ§Øª Ø¨Ø¹Ø¯.</div>';
        return;
      }
      let notes=[];
      try{ notes=JSON.parse(s)||[]; }catch{}
      if(notes.length===0){
        notesListEl.innerHTML='<div style="font-size:12px;color:var(--text-soft);">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ÙˆØªØ§Øª Ø¨Ø¹Ø¯.</div>';
        return;
      }
      notes.forEach(renderNote);
    }

    function subscribeToNotes(){
      if(!currentUser) return;
      if(notesUnsubscribe) notesUnsubscribe();
      notesUnsubscribe = db.collection("notes")
        .where("uid","==",currentUser.uid)
        .orderBy("createdAt","desc")
        .onSnapshot(snap=>{
          notesListEl.innerHTML="";
          if(snap.empty){
            notesListEl.innerHTML='<div style="font-size:12px;color:var(--text-soft);">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ÙˆØªØ§Øª Ø¨Ø¹Ø¯.</div>';
            return;
          }
          snap.forEach(doc=>{
            const n=doc.data();
            renderNote({
              title:n.title,
              content:n.content,
              imageUrl:n.imageUrl,
              color:n.color,
              fontSize:n.fontSize,
              createdAt: n.createdAt?.toDate ? n.createdAt.toDate().toLocaleString("ar-JO") : ""
            });
          });
        });
    }

    noteForm.addEventListener("submit", async (e)=>{
      e.preventDefault();
      const title=noteTitleInput.value.trim();
      const content=noteContentInput.value.trim();
      const imageUrl=noteImageUrlInput.value.trim();
      const color=noteColorInput.value;
      const fontSize=parseInt(noteFontSizeSelect.value,10)||13;
      if(!content) return;

      if(!currentUser){
        const s=localStorage.getItem("guest_notes");
        let notes=[];
        try{ notes=JSON.parse(s)||[]; }catch{}
        notes.unshift({
          title, content, imageUrl: imageUrl||null, color, fontSize,
          createdAt: new Date().toLocaleString("ar-JO")
        });
        saveGuestNotes(notes);
        loadGuestNotes();
      }else{
        await db.collection("notes").add({
          uid: currentUser.uid,
          title, content,
          imageUrl: imageUrl||null,
          color, fontSize,
          createdAt: firebase.firestore.FieldValue.serverTimestamp(),
        });
      }

      noteTitleInput.value="";
      noteImageUrlInput.value="";
      noteContentInput.value="";
    });

    // Initial guest load
    loadGuestCounters();
    loadGuestNotes();
  </script>
</body>
</html>
